<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Round Table AI Chat Monitor</title>
  <link rel="stylesheet" href="/haven-ui/assets/style.css" />
  <link rel="manifest" href="/haven-ui/manifest.webmanifest">
  <meta name="theme-color" content="#00C2B3">
</head>
<body>
  <div class="app container">
    <header>
      <h1>Round Table AI Chat Monitor</h1>
      <nav><a href="index.html">Back</a></nav>
    </header>
    <main>
      <div id="chat" class="card" style="height:400px; overflow:auto"></div>
      <button onclick="loadChat()">Reload</button>
      <button onclick="clearChat()">Clear</button>
    </main>
  </div>
<script>
  async function loadChat(){
    const r = await fetch('/api/rtai/history');
    const j = await r.json();
    const el = document.getElementById('chat');
    el.innerHTML = '';
    (j.messages || []).forEach(m => {
      const d = document.createElement('div'); d.textContent = m; el.appendChild(d);
    });
  }
  async function clearChat(){
    const r = await fetch('/api/rtai/clear', { method: 'POST' });
    if (r.ok) loadChat();
  }
  window.onload = loadChat;
  if ('serviceWorker' in navigator) { navigator.serviceWorker.register('/haven-ui/sw.js').catch(()=>{}); }
    try{
      const protocol = window.location.protocol === 'https:' ? 'wss' : 'ws';
      const ws = new WebSocket(`${protocol}://${window.location.host}/ws/rtai`);
      ws.onmessage = (ev) => {
        const el = document.getElementById('chat');
        const d = document.createElement('div'); d.textContent = ev.data; el.appendChild(d);
        el.scrollTop = el.scrollHeight;
      }
    }catch(e){ console.warn('RTAI websocket not available', e); }
</script>
</body>
</html>