<!DOCTYPE html>
<html><!-- logs.html for viewing control-room logs -->
<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <title>Haven - Logs</title>
  <link rel='stylesheet' href='/haven-ui/assets/style.css'>
  <link rel='manifest' href='/haven-ui/manifest.webmanifest'>
  <meta name='theme-color' content='#00C2B3'>
</head>
<body>
  <div class='app container'>
    <header>
      <h1>Logs</h1>
      <nav><a href='index.html'>Back</a></nav>
    </header>
    <main>
      <pre id='logs' style='height:400px; overflow:auto; background:#021020; padding:8px;'></pre>
      <button onclick='loadLogs()'>Reload</button>
    </main>
  </div>
<script>
  async function loadLogs(){
    const r = await fetch('/api/logs');
    const j = await r.json();
    document.getElementById('logs').innerText = (j.lines || []).join('');
  }
  window.onload = ()=>{
    loadLogs();
    // Also connect a websocket for live tailing
    try{
      const protocol = window.location.protocol === 'https:' ? 'wss' : 'ws';
      const ws = new WebSocket(`${protocol}://${window.location.host}/ws/logs`);
      ws.onmessage = (ev) => { const pre = document.getElementById('logs'); pre.innerText += ev.data + '\n'; pre.scrollTop = pre.scrollHeight; };
    }catch(e){ console.warn('WS logs not available', e); }
    setInterval(loadLogs, 5000);
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/haven-ui/sw.js').catch(()=>{});
    }
  };
</script>
</body>
</html>