import{j as e}from"./vendor-three-B8lJlG1P.js";import{u as G,b as i}from"./vendor-react-D7IcbEIw.js";import{a as m}from"./vendor-ui-B9ygI19o.js";import{C as y}from"./Card-C4YgI0Ez.js";import{B as l}from"./Button-CI6OWZ-Z.js";import{A as T,M as b}from"./index-DfzvULyl.js";const f=[{id:"system_create",label:"Create Systems",description:"Can create new star systems"},{id:"system_edit",label:"Edit Systems",description:"Can edit systems tagged with their Discord"},{id:"approvals",label:"View Approvals",description:"Can approve/reject pending submissions for their Discord"},{id:"batch_approvals",label:"Batch Approvals",description:"Can approve or reject multiple submissions at once"},{id:"stats",label:"View Statistics",description:"Can view database statistics for their Discord"},{id:"settings",label:"Theme Settings",description:"Can customize their theme colors"},{id:"csv_import",label:"CSV Import",description:"Can bulk import star systems from CSV files"}];function W(){const j=G(),v=i.useContext(T),[N,D]=i.useState([]),[k,w]=i.useState(!0),[r,d]=i.useState(!1),[S,x]=i.useState(!1),[A,p]=i.useState(!1),[F,u]=i.useState(!1),[o,_]=i.useState(null),[a,t]=i.useState({username:"",password:"",discord_tag:"",display_name:"",enabled_features:[]});i.useEffect(()=>{if(!v.isSuperAdmin){alert("Super admin access required"),j("/systems");return}g()},[v.isSuperAdmin,j]);async function g(){w(!0);try{const s=await m.get("/api/partners");D(s.data.partners||[])}catch(s){alert("Failed to load partners: "+(s.response?.data?.detail||s.message))}finally{w(!1)}}function h(){t({username:"",password:"",discord_tag:"",display_name:"",enabled_features:[]})}async function E(){if(!a.username.trim()||a.username.length<3){alert("Username must be at least 3 characters");return}if(!a.password||a.password.length<4){alert("Password must be at least 4 characters");return}d(!0);try{await m.post("/api/partners",{username:a.username.trim(),password:a.password,discord_tag:a.discord_tag.trim()||null,display_name:a.display_name.trim()||a.username.trim(),enabled_features:a.enabled_features}),alert("Partner account created successfully!"),x(!1),h(),g()}catch(s){alert("Failed to create partner: "+(s.response?.data?.detail||s.message))}finally{d(!1)}}async function M(){d(!0);try{await m.put(`/api/partners/${o.id}`,{discord_tag:a.discord_tag.trim()||null,display_name:a.display_name.trim(),enabled_features:a.enabled_features}),alert("Partner updated successfully!"),p(!1),g()}catch(s){alert("Failed to update partner: "+(s.response?.data?.detail||s.message))}finally{d(!1)}}async function O(){if(!a.password||a.password.length<4){alert("Password must be at least 4 characters");return}d(!0);try{await m.post(`/api/partners/${o.id}/reset_password`,{password:a.password}),alert("Password reset successfully!"),u(!1),h()}catch(s){alert("Failed to reset password: "+(s.response?.data?.detail||s.message))}finally{d(!1)}}async function $(s){const n=s.is_active?"deactivate":"activate";if(!(s.is_active&&!confirm(`Deactivate partner "${s.display_name||s.username}"?

They will not be able to log in until reactivated.`))){d(!0);try{s.is_active?await m.delete(`/api/partners/${s.id}`):await m.post(`/api/partners/${s.id}/activate`),g()}catch(c){alert(`Failed to ${n} partner: `+(c.response?.data?.detail||c.message))}finally{d(!1)}}}function L(s){_(s),t({username:s.username,password:"",discord_tag:s.discord_tag||"",display_name:s.display_name||"",enabled_features:s.enabled_features||[]}),p(!0)}function R(s){_(s),t({...a,password:""}),u(!0)}function C(s){t(n=>({...n,enabled_features:n.enabled_features.includes(s)?n.enabled_features.filter(c=>c!==s):[...n.enabled_features,s]}))}function P(s){return s?new Date(s).toLocaleString():"Never"}return k?e.jsx("div",{className:"flex items-center justify-center min-h-64",children:e.jsx("div",{className:"text-lg text-gray-400",children:"Loading partners..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-cyan-400",children:"Partner Management"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Create and manage login accounts for partner Discord servers"})]}),e.jsx(l,{onClick:()=>{h(),x(!0)},disabled:r,children:"+ Add Partner"})]}),e.jsx(y,{className:"bg-gray-800/50 border border-cyan-900/50",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-cyan-400 font-semibold mb-2",children:"About Partner Accounts"}),e.jsxs("ul",{className:"text-gray-300 text-sm space-y-1 list-disc list-inside",children:[e.jsx("li",{children:'Each partner account is tied to a Discord server via a short tag (e.g., "GHDF", "NMSHub")'}),e.jsx("li",{children:"Partners can only edit systems/regions tagged with their Discord"}),e.jsx("li",{children:"When partners edit untagged systems, it requires your approval"}),e.jsx("li",{children:"You control which features each partner has access to"}),e.jsx("li",{children:"Multiple admins from the same Discord can share one login"})]})]})}),N.length===0?e.jsx(y,{className:"bg-gray-800/50",children:e.jsxs("div",{className:"p-8 text-center text-gray-400",children:[e.jsx("p",{className:"text-lg mb-2",children:"No partner accounts yet"}),e.jsx("p",{className:"text-sm",children:"Create a partner account to give other Discord servers their own space."})]})}):e.jsx("div",{className:"space-y-4",children:N.map(s=>e.jsx(y,{className:`bg-gray-800/50 border ${s.is_active?"border-gray-700":"border-red-900/50"}`,children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:s.display_name||s.username}),e.jsxs("span",{className:"text-sm text-gray-400",children:["@",s.username]}),s.is_active?e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-green-900/50 text-green-400 border border-green-700",children:"Active"}):e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-red-900/50 text-red-400 border border-red-700",children:"Inactive"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Discord Tag:"}),e.jsx("p",{className:"text-cyan-400 font-mono",children:s.discord_tag||"Not set"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Created:"}),e.jsx("p",{className:"text-gray-300",children:P(s.created_at)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Last Login:"}),e.jsx("p",{className:"text-gray-300",children:P(s.last_login_at)})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-sm",children:"Enabled Features: "}),e.jsx("span",{className:"text-gray-400 text-sm",children:(s.enabled_features||[]).length>0?s.enabled_features.map(n=>{const c=f.find(H=>H.id===n);return c?c.label:n}).join(", "):"None"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 ml-4",children:[e.jsx(l,{variant:"secondary",size:"sm",onClick:()=>L(s),disabled:r,children:"Edit"}),e.jsx(l,{variant:"secondary",size:"sm",onClick:()=>R(s),disabled:r,children:"Reset Password"}),e.jsx(l,{variant:s.is_active?"danger":"primary",size:"sm",onClick:()=>$(s),disabled:r,children:s.is_active?"Deactivate":"Activate"})]})]})})},s.id))}),e.jsx(b,{isOpen:S,onClose:()=>x(!1),title:"Create Partner Account",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Username *"}),e.jsx("input",{type:"text",value:a.username,onChange:s=>t({...a,username:s.target.value}),placeholder:"e.g., GHDFAdmin",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"Login username (min 3 characters)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Password *"}),e.jsx("input",{type:"password",value:a.password,onChange:s=>t({...a,password:s.target.value}),placeholder:"Enter password",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"Min 4 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Discord Tag"}),e.jsx("input",{type:"text",value:a.discord_tag,onChange:s=>t({...a,discord_tag:s.target.value}),placeholder:"e.g., GHDF",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"Short identifier for their Discord server. Systems/regions with this tag belong to them."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Display Name"}),e.jsx("input",{type:"text",value:a.display_name,onChange:s=>t({...a,display_name:s.target.value}),placeholder:"e.g., Galactic Hub Defense Force",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"Friendly name shown in the UI"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Enabled Features"}),e.jsx("div",{className:"space-y-2 bg-gray-800 p-3 rounded border border-gray-700",children:f.map(s=>e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.enabled_features.includes(s.id),onChange:()=>C(s.id),className:"mt-1"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white",children:s.label}),e.jsx("p",{className:"text-gray-500 text-xs",children:s.description})]})]},s.id))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-700",children:[e.jsx(l,{variant:"secondary",onClick:()=>x(!1),children:"Cancel"}),e.jsx(l,{onClick:E,disabled:r||!a.username.trim()||!a.password,children:r?"Creating...":"Create Partner"})]})]})}),e.jsx(b,{isOpen:A,onClose:()=>p(!1),title:`Edit ${o?.display_name||o?.username||"Partner"}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Discord Tag"}),e.jsx("input",{type:"text",value:a.discord_tag,onChange:s=>t({...a,discord_tag:s.target.value}),placeholder:"e.g., GHDF",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Display Name"}),e.jsx("input",{type:"text",value:a.display_name,onChange:s=>t({...a,display_name:s.target.value}),placeholder:"e.g., Galactic Hub Defense Force",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Enabled Features"}),e.jsx("div",{className:"space-y-2 bg-gray-800 p-3 rounded border border-gray-700",children:f.map(s=>e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.enabled_features.includes(s.id),onChange:()=>C(s.id),className:"mt-1"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white",children:s.label}),e.jsx("p",{className:"text-gray-500 text-xs",children:s.description})]})]},s.id))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-700",children:[e.jsx(l,{variant:"secondary",onClick:()=>p(!1),children:"Cancel"}),e.jsx(l,{onClick:M,disabled:r,children:r?"Saving...":"Save Changes"})]})]})}),e.jsx(b,{isOpen:F,onClose:()=>u(!1),title:`Reset Password for ${o?.display_name||o?.username||"Partner"}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"New Password *"}),e.jsx("input",{type:"password",value:a.password,onChange:s=>t({...a,password:s.target.value}),placeholder:"Enter new password",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"Min 4 characters"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-700",children:[e.jsx(l,{variant:"secondary",onClick:()=>u(!1),children:"Cancel"}),e.jsx(l,{onClick:O,disabled:r||!a.password||a.password.length<4,children:r?"Resetting...":"Reset Password"})]})]})})]})}export{W as default};
