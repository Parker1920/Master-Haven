import{j as e}from"./vendor-three-B8lJlG1P.js";import{b as n}from"./vendor-react-D7IcbEIw.js";import{A as S}from"./index-CIVSKp76.js";import{C as h}from"./Card-C4YgI0Ez.js";import{B as w}from"./Button-CI6OWZ-Z.js";import"./vendor-ui-B9ygI19o.js";function O(){const p=n.useContext(S),{isSuperAdmin:C,isPartner:g,user:j}=p||{},a=n.useRef(null),[l,d]=n.useState(null),[m,x]=n.useState(!1),[t,o]=n.useState(null),[u,c]=n.useState(!1),f=s=>{const r=s.target.files?.[0];r&&r.name.endsWith(".csv")&&(d(r),o(null))},y=s=>{s.preventDefault(),c(!1);const r=s.dataTransfer.files?.[0];r&&r.name.endsWith(".csv")&&(d(r),o(null))},N=s=>{s.preventDefault(),c(!0)},b=()=>{c(!1)},v=async()=>{if(l){x(!0),o(null);try{const s=new FormData;s.append("file",l);const r=await fetch("/api/import_csv",{method:"POST",credentials:"include",body:s}),i=await r.json();if(!r.ok)throw new Error(i.detail||"Import failed");o({success:!0,imported:i.imported,skipped:i.skipped,errors:i.errors,totalErrors:i.total_errors,regionName:i.region_name}),d(null),a.current&&(a.current.value="")}catch(s){o({success:!1,error:s.message})}finally{x(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-cyan-400",children:"CSV Import"}),e.jsx(h,{className:"bg-gray-800/50",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Import Star Systems from CSV"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Upload a CSV file exported from Google Sheets to import star systems directly into the database."}),e.jsxs("div",{className:"mb-6 p-3 bg-gray-700/50 rounded border border-gray-600",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-300 mb-2",children:"Expected CSV Format:"}),e.jsxs("ul",{className:"text-xs text-gray-400 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Row 1:"}),' Region name (e.g., "HUB1 - Sea of Xionahui")']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Row 2:"})," Headers (Coordinates, Original System Name, HUB Tag, New System Name, etc.)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Row 3+:"})," Data rows"]})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-400",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Required columns:"})," Coordinates (galactic format XXXX:YYYY:ZZZZ:SSSS), New System Name"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Stored in notes:"})," HUB Tag, Original System Name, Comments/Special Attributes"]})]})]}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer
              ${u?"border-cyan-400 bg-cyan-900/20":"border-gray-600 hover:border-gray-500"}`,onDrop:y,onDragOver:N,onDragLeave:b,onClick:()=>a.current?.click(),children:[e.jsx("input",{ref:a,type:"file",accept:".csv",onChange:f,className:"hidden"}),l?e.jsxs("div",{children:[e.jsx("div",{className:"text-lg text-cyan-400 font-semibold",children:l.name}),e.jsxs("div",{className:"text-sm text-gray-400 mt-1",children:[(l.size/1024).toFixed(1)," KB"]}),e.jsx("button",{onClick:s=>{s.stopPropagation(),d(null),a.current&&(a.current.value="")},className:"mt-2 text-sm text-red-400 hover:text-red-300",children:"Remove file"})]}):e.jsxs("div",{children:[e.jsx("div",{className:"text-lg text-gray-300",children:"Drop CSV file here"}),e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"or click to browse"})]})]}),e.jsx("div",{className:"mt-4 flex gap-4",children:e.jsx(w,{onClick:v,disabled:!l||m,children:m?"Importing...":"Import Systems"})}),t&&e.jsx("div",{className:`mt-6 p-4 rounded border ${t.success?"bg-green-900/30 border-green-700":"bg-red-900/30 border-red-700"}`,children:t.success?e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-green-400 mb-2",children:"Import Complete"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Systems Imported:"}),e.jsx("span",{className:"ml-2 text-green-400 font-semibold",children:t.imported})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Systems Skipped:"}),e.jsx("span",{className:"ml-2 text-yellow-400 font-semibold",children:t.skipped})]}),t.regionName&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-gray-400",children:"Region:"}),e.jsx("span",{className:"ml-2 text-cyan-400",children:t.regionName})]})]}),t.errors&&t.errors.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("h5",{className:"text-sm font-semibold text-yellow-400 mb-1",children:["Errors (",t.totalErrors," total, showing first ",t.errors.length,"):"]}),e.jsx("ul",{className:"text-xs text-gray-400 space-y-1 max-h-32 overflow-y-auto",children:t.errors.map((s,r)=>e.jsx("li",{className:"text-red-300",children:s},r))})]})]}):e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-red-400 mb-2",children:"Import Failed"}),e.jsx("p",{className:"text-sm text-red-300",children:t.error})]})})]})}),g&&e.jsx(h,{className:"bg-gray-800/50",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"About CSV Import"}),e.jsxs("ul",{className:"text-sm text-gray-400 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:["Imported systems will be tagged with your Discord (",j?.discordTag,")"]}),e.jsx("li",{children:"Duplicate systems (same glyph code) will be skipped"}),e.jsx("li",{children:"Systems are imported directly into the database (no approval needed)"})]})]})})]})}export{O as default};
