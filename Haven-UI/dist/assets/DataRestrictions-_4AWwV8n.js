import{j as e}from"./vendor-three-B8lJlG1P.js";import{b as i}from"./vendor-react-D7IcbEIw.js";import{A as Y}from"./index-CIVSKp76.js";import{C as R}from"./Card-C4YgI0Ez.js";import{B as r}from"./Button-CI6OWZ-Z.js";import"./vendor-ui-B9ygI19o.js";const F=[{id:"coordinates",label:"Coordinates",description:"X, Y, Z position and region coordinates"},{id:"glyph_code",label:"Portal Glyphs",description:"Glyph code and portal address"},{id:"discovered_by",label:"Discoverer",description:"Who discovered the system and when"},{id:"base_location",label:"Base Locations",description:"Base coordinates on planets"},{id:"description",label:"Description",description:"System description text"},{id:"star_type",label:"Star Info",description:"Star type, economy, conflict level"},{id:"planets",label:"Planet Details",description:"Hide detailed planet info (shows count only)"}],E=[{value:"normal",label:"Normal",description:"Fully visible with all hover details"},{value:"point_only",label:"Point Only",description:"Shows as a dot but no hover information"},{value:"hidden",label:"Hidden",description:"Does not appear on maps at all"}];function ee(){const A=i.useContext(Y),{isAdmin:z,isSuperAdmin:_}=A||{},[o,$]=i.useState([]),[M,S]=i.useState(!0),[l,n]=i.useState(!1),[y,P]=i.useState(""),[t,v]=i.useState(new Set),[c,k]=i.useState(null),[L,b]=i.useState(!1),[f,x]=i.useState(!1),[d,h]=i.useState([]),[m,p]=i.useState("normal");i.useEffect(()=>{u()},[]);const u=async()=>{S(!0);try{const s=await fetch("/api/partner/my_systems",{credentials:"include"});if(!s.ok)throw new Error("Failed to load systems");const a=await s.json();$(a.systems||[])}catch(s){console.error("Failed to load systems:",s)}finally{S(!1)}},j=i.useMemo(()=>{if(!y.trim())return o;const s=y.toLowerCase();return o.filter(a=>a.name?.toLowerCase().includes(s)||a.galaxy?.toLowerCase().includes(s)||a.region_name?.toLowerCase().includes(s)||a.discord_tag?.toLowerCase().includes(s))},[o,y]),B=s=>{const a=new Set(t);a.has(s)?a.delete(s):a.add(s),v(a)},T=()=>{v(new Set(j.map(s=>s.id)))},N=()=>{v(new Set)},D=s=>{k(s),s.restriction?(x(s.restriction.is_hidden_from_public),h(s.restriction.hidden_fields||[]),p(s.restriction.map_visibility||"normal")):(x(!1),h([]),p("normal"))},H=()=>{x(!1),h([]),p("normal"),b(!0)},g=()=>{k(null),b(!1)},C=s=>{d.includes(s)?h(d.filter(a=>a!==s)):h([...d,s])},O=async()=>{if(c){n(!0);try{const s=await fetch("/api/data_restrictions",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({system_id:c.id,is_hidden_from_public:f,hidden_fields:d,map_visibility:m})});if(!s.ok){const a=await s.json();throw new Error(a.detail||"Failed to save")}await u(),g()}catch(s){alert("Failed to save restriction: "+s.message)}finally{n(!1)}}},I=async()=>{if(c&&confirm("Remove all restrictions from this system?")){n(!0);try{const s=await fetch(`/api/data_restrictions/${c.id}`,{method:"DELETE",credentials:"include"});if(!s.ok){const a=await s.json();throw new Error(a.detail||"Failed to remove")}await u(),g()}catch(s){alert("Failed to remove restriction: "+s.message)}finally{n(!1)}}},V=async()=>{if(t.size!==0){n(!0);try{const s=await fetch("/api/data_restrictions/bulk",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({system_ids:Array.from(t),is_hidden_from_public:f,hidden_fields:d,map_visibility:m})});if(!s.ok){const w=await s.json();throw new Error(w.detail||"Failed to save")}const a=await s.json();alert(`Restrictions applied: ${a.created} created, ${a.updated} updated, ${a.skipped} skipped`),await u(),b(!1),N()}catch(s){alert("Failed to save restrictions: "+s.message)}finally{n(!1)}}},J=async()=>{if(t.size!==0&&confirm(`Remove restrictions from ${t.size} systems?`)){n(!0);try{const s=await fetch("/api/data_restrictions/bulk_remove",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({system_ids:Array.from(t)})});if(!s.ok){const w=await s.json();throw new Error(w.detail||"Failed to remove")}const a=await s.json();alert(`Restrictions removed from ${a.removed} systems (${a.skipped} skipped)`),await u(),N()}catch(s){alert("Failed to remove restrictions: "+s.message)}finally{n(!1)}}};if(!z)return e.jsx("div",{className:"text-center py-12 text-gray-500",children:"Please log in to manage data restrictions."});const G=o.length,Q=o.filter(s=>s.has_restriction).length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Data Restrictions"}),e.jsxs("p",{className:"text-gray-400 text-sm mt-1",children:["Control which data is visible to public viewers. ",_?"Viewing all systems.":"Viewing your systems."]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs("span",{className:"px-3 py-1 bg-gray-700 rounded",children:[G," systems"]}),e.jsxs("span",{className:"px-3 py-1 bg-yellow-600 rounded",children:[Q," restricted"]})]})]}),e.jsxs(R,{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("input",{type:"text",placeholder:"Search systems...",value:y,onChange:s=>P(s.target.value),className:"flex-1 px-4 py-2 bg-gray-800 border border-gray-600 rounded focus:outline-none focus:border-cyan-500"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{onClick:T,variant:"secondary",size:"sm",children:"Select All"}),e.jsx(r,{onClick:N,variant:"secondary",size:"sm",children:"Clear"})]})]}),t.size>0&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-800 rounded flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("span",{className:"text-cyan-400 font-medium",children:[t.size," systems selected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{onClick:H,variant:"primary",size:"sm",children:"Apply Restrictions"}),e.jsx(r,{onClick:J,variant:"danger",size:"sm",children:"Remove Restrictions"})]})]})]}),e.jsx(R,{children:M?e.jsx("div",{className:"p-8 text-center text-gray-400",children:"Loading systems..."}):j.length===0?e.jsx("div",{className:"p-8 text-center text-gray-400",children:o.length===0?"No systems found.":"No systems match your search."}):e.jsx("div",{className:"divide-y divide-gray-700",children:j.map(s=>e.jsxs("div",{className:`p-4 flex items-center gap-4 hover:bg-gray-800/50 transition-colors ${t.has(s.id)?"bg-gray-800":""}`,children:[e.jsx("input",{type:"checkbox",checked:t.has(s.id),onChange:()=>B(s.id),className:"w-5 h-5 rounded border-gray-600 text-cyan-500 focus:ring-cyan-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium truncate",children:s.name}),e.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-700 rounded",children:s.galaxy}),_&&s.discord_tag&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-purple-700 rounded",children:s.discord_tag})]}),e.jsx("div",{className:"text-sm text-gray-400 mt-1",children:s.region_name||`Region (${s.region_x}, ${s.region_y}, ${s.region_z})`})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[s.has_restriction?e.jsxs("div",{className:"flex items-center gap-2",children:[s.restriction.is_hidden_from_public&&e.jsx("span",{className:"text-xs px-2 py-1 bg-red-600 rounded",children:"HIDDEN"}),s.restriction.hidden_fields?.length>0&&e.jsxs("span",{className:"text-xs px-2 py-1 bg-yellow-600 rounded",children:[s.restriction.hidden_fields.length," fields"]}),s.restriction.map_visibility!=="normal"&&e.jsx("span",{className:"text-xs px-2 py-1 bg-orange-600 rounded",children:s.restriction.map_visibility==="hidden"?"Map Hidden":"Point Only"})]}):e.jsx("span",{className:"text-xs text-gray-500",children:"Public"}),e.jsx(r,{onClick:()=>D(s),variant:"secondary",size:"sm",children:"Configure"})]})]},s.id))})}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 rounded-lg max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-700",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Configure Restrictions"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:c.name})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-800 rounded",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Hide from Public"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Completely hide this system from non-owners"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:s=>x(s.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-700 peer-focus:ring-2 peer-focus:ring-cyan-500 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-600"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-3",children:"Hide Specific Fields"}),e.jsx("div",{className:"space-y-2",children:F.map(s=>e.jsxs("label",{className:"flex items-start gap-3 p-3 bg-gray-800 rounded cursor-pointer hover:bg-gray-750",children:[e.jsx("input",{type:"checkbox",checked:d.includes(s.id),onChange:()=>C(s.id),className:"w-5 h-5 mt-0.5 rounded border-gray-600 text-cyan-500 focus:ring-cyan-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.label}),e.jsx("div",{className:"text-sm text-gray-400",children:s.description})]})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-3",children:"Map Visibility"}),e.jsx("div",{className:"space-y-2",children:E.map(s=>e.jsxs("label",{className:`flex items-start gap-3 p-3 rounded cursor-pointer ${m===s.value?"bg-cyan-900/30 border border-cyan-500":"bg-gray-800 hover:bg-gray-750"}`,children:[e.jsx("input",{type:"radio",name:"mapVisibility",value:s.value,checked:m===s.value,onChange:a=>p(a.target.value),className:"w-5 h-5 mt-0.5 text-cyan-500 focus:ring-cyan-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.label}),e.jsx("div",{className:"text-sm text-gray-400",children:s.description})]})]},s.value))})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-700 flex justify-between",children:[e.jsx(r,{onClick:I,variant:"danger",disabled:l||!c.has_restriction,children:"Remove All"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{onClick:g,variant:"secondary",disabled:l,children:"Cancel"}),e.jsx(r,{onClick:O,variant:"primary",disabled:l,children:l?"Saving...":"Save"})]})]})]})}),L&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-900 rounded-lg max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-700",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Bulk Apply Restrictions"}),e.jsxs("p",{className:"text-gray-400 text-sm mt-1",children:["Apply to ",t.size," selected systems"]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-800 rounded",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Hide from Public"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Completely hide these systems from non-owners"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:s=>x(s.target.checked),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-700 peer-focus:ring-2 peer-focus:ring-cyan-500 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-600"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-3",children:"Hide Specific Fields"}),e.jsx("div",{className:"space-y-2",children:F.map(s=>e.jsxs("label",{className:"flex items-start gap-3 p-3 bg-gray-800 rounded cursor-pointer hover:bg-gray-750",children:[e.jsx("input",{type:"checkbox",checked:d.includes(s.id),onChange:()=>C(s.id),className:"w-5 h-5 mt-0.5 rounded border-gray-600 text-cyan-500 focus:ring-cyan-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.label}),e.jsx("div",{className:"text-sm text-gray-400",children:s.description})]})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-3",children:"Map Visibility"}),e.jsx("div",{className:"space-y-2",children:E.map(s=>e.jsxs("label",{className:`flex items-start gap-3 p-3 rounded cursor-pointer ${m===s.value?"bg-cyan-900/30 border border-cyan-500":"bg-gray-800 hover:bg-gray-750"}`,children:[e.jsx("input",{type:"radio",name:"bulkMapVisibility",value:s.value,checked:m===s.value,onChange:a=>p(a.target.value),className:"w-5 h-5 mt-0.5 text-cyan-500 focus:ring-cyan-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.label}),e.jsx("div",{className:"text-sm text-gray-400",children:s.description})]})]},s.value))})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-700 flex justify-end gap-2",children:[e.jsx(r,{onClick:g,variant:"secondary",disabled:l,children:"Cancel"}),e.jsx(r,{onClick:V,variant:"primary",disabled:l,children:l?"Applying...":`Apply to ${t.size} Systems`})]})]})})]})}export{ee as default};
