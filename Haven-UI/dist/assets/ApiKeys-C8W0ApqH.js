import{j as e}from"./vendor-three-B8lJlG1P.js";import{u as J,b as a}from"./vendor-react-D7IcbEIw.js";import{a as n}from"./vendor-ui-B9ygI19o.js";import{C as j}from"./Card-C4YgI0Ez.js";import{B as t}from"./Button-CI6OWZ-Z.js";import{M as f}from"./index-DfzvULyl.js";import{a as Q}from"./api-CLX3FGN7.js";function le(){const u=J(),[X,D]=a.useState(!1),[E,b]=a.useState(!0),[v,L]=a.useState([]),[O,x]=a.useState(!1),[$,g]=a.useState(!1),[l,F]=a.useState(null),[i,r]=a.useState(!1),[N,q]=a.useState([]),[z,y]=a.useState(!1),[p,w]=a.useState(null),[h,k]=a.useState(""),[K,P]=a.useState(200),[C,A]=a.useState(""),[c,S]=a.useState(""),[I,_]=a.useState(200),[T,M]=a.useState("");a.useEffect(()=>{Q().then(s=>{D(s.logged_in),s.logged_in?(d(),W()):(alert("Admin authentication required"),u("/systems"))}).catch(()=>{alert("Failed to verify admin status"),u("/systems")})},[u]);async function W(){try{const s=await n.get("/api/discord_tags");q(s.data.tags||[])}catch(s){console.error("Failed to load discord tags:",s)}}async function d(){b(!0);try{const s=await n.get("/api/keys");L(s.data.keys||[])}catch(s){alert("Failed to load API keys: "+(s.response?.data?.detail||s.message))}finally{b(!1)}}async function B(){if(!h.trim()){alert("Please enter a name for the API key");return}r(!0);try{const s=await n.post("/api/keys",{name:h.trim(),rate_limit:K,permissions:["submit","check_duplicate"],discord_tag:C||null});F(s.data),x(!1),g(!0),k(""),P(200),A(""),d()}catch(s){alert("Failed to create API key: "+(s.response?.data?.detail||s.message))}finally{r(!1)}}async function V(s,o){if(confirm(`Revoke API key "${o}"?

This will immediately invalidate the key. Any companion apps using it will stop working.`)){r(!0);try{await n.delete(`/api/keys/${s}`),alert(`API key "${o}" has been revoked.`),d()}catch(m){alert("Failed to revoke API key: "+(m.response?.data?.detail||m.message))}finally{r(!1)}}}async function G(s,o){r(!0);try{await n.put(`/api/keys/${s}`,{is_active:!0}),alert(`API key "${o}" has been reactivated.`),d()}catch(m){alert("Failed to reactivate API key: "+(m.response?.data?.detail||m.message))}finally{r(!1)}}function H(s){w(s),S(s.name),_(s.rate_limit),M(s.discord_tag||""),y(!0)}async function U(){if(!c.trim()){alert("Please enter a name for the API key");return}r(!0);try{await n.put(`/api/keys/${p.id}`,{name:c.trim(),rate_limit:I,discord_tag:T||null}),alert(`API key "${c}" has been updated.`),y(!1),w(null),d()}catch(s){alert("Failed to update API key: "+(s.response?.data?.detail||s.message))}finally{r(!1)}}function Y(s){navigator.clipboard.writeText(s).then(()=>{alert("API key copied to clipboard!")}).catch(()=>{alert("Failed to copy to clipboard. Please copy manually.")})}function R(s){return s?new Date(s).toLocaleString():"Never"}return E?e.jsx("div",{className:"flex items-center justify-center min-h-64",children:e.jsx("div",{className:"text-lg text-gray-400",children:"Loading API keys..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-cyan-400",children:"API Keys"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Manage API keys for the NMS Save Watcher companion app and other integrations"})]}),e.jsx(t,{onClick:()=>x(!0),disabled:i,children:"+ Create New Key"})]}),e.jsx(j,{className:"bg-gray-800/50 border border-cyan-900/50",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-cyan-400 font-semibold mb-2",children:"About API Keys"}),e.jsxs("ul",{className:"text-gray-300 text-sm space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"API keys allow external applications to submit systems to Voyagers Haven"}),e.jsx("li",{children:"Submissions via API key go to the pending approval queue (same as manual submissions)"}),e.jsx("li",{children:"Each key has its own rate limit (default: 200 requests/hour)"}),e.jsx("li",{children:"Keys are shown only once when created - save them securely!"}),e.jsx("li",{children:"Revoked keys can be reactivated if needed"})]})]})}),v.length===0?e.jsx(j,{className:"bg-gray-800/50",children:e.jsxs("div",{className:"p-8 text-center text-gray-400",children:[e.jsx("p",{className:"text-lg mb-2",children:"No API keys yet"}),e.jsx("p",{className:"text-sm",children:"Create an API key to allow the NMS Save Watcher companion app to submit discoveries."})]})}):e.jsx("div",{className:"space-y-4",children:v.map(s=>e.jsx(j,{className:`bg-gray-800/50 border ${s.is_active?"border-gray-700":"border-red-900/50"}`,children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:s.name}),s.is_active?e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-green-900/50 text-green-400 border border-green-700",children:"Active"}):e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-red-900/50 text-red-400 border border-red-700",children:"Revoked"}),s.discord_tag&&e.jsx("span",{className:`px-2 py-0.5 text-xs rounded-full border ${s.discord_tag==="personal"?"bg-fuchsia-900/50 text-fuchsia-400 border-fuchsia-700":"bg-cyan-900/50 text-cyan-400 border-cyan-700"}`,children:s.discord_tag})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Key Prefix:"}),e.jsxs("p",{className:"text-gray-300 font-mono",children:[s.key_prefix,"..."]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Rate Limit:"}),e.jsxs("p",{className:"text-gray-300",children:[s.rate_limit,"/hour"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Created:"}),e.jsx("p",{className:"text-gray-300",children:R(s.created_at)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Last Used:"}),e.jsx("p",{className:"text-gray-300",children:R(s.last_used_at)})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-gray-500 text-sm",children:"Permissions: "}),e.jsx("span",{className:"text-gray-400 text-sm",children:(s.permissions||[]).join(", ")||"None"})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx(t,{variant:"secondary",size:"sm",onClick:()=>H(s),disabled:i,children:"Edit"}),s.is_active?e.jsx(t,{variant:"danger",size:"sm",onClick:()=>V(s.id,s.name),disabled:i,children:"Revoke"}):e.jsx(t,{variant:"secondary",size:"sm",onClick:()=>G(s.id,s.name),disabled:i,children:"Reactivate"})]})]})})},s.id))}),e.jsx(f,{isOpen:O,onClose:()=>x(!1),title:"Create API Key",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Key Name *"}),e.jsx("input",{type:"text",value:h,onChange:s=>k(s.target.value),placeholder:"e.g., Parker's Companion App",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"A descriptive name to identify this key"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Rate Limit (requests/hour)"}),e.jsx("input",{type:"number",value:K,onChange:s=>P(parseInt(s.target.value)||200),min:"1",max:"1000",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"Maximum submissions per hour (default: 200)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Discord Community Tag"}),e.jsxs("select",{value:C,onChange:s=>A(s.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",children:[e.jsx("option",{value:"",children:"-- Select a tag --"}),e.jsx("option",{value:"personal",children:"Personal"}),N.map(s=>e.jsxs("option",{value:s.tag,children:[s.name," (",s.tag,")"]},s.tag))]}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"Submissions via this key will be auto-tagged with this community"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-700",children:[e.jsx(t,{variant:"secondary",onClick:()=>x(!1),children:"Cancel"}),e.jsx(t,{onClick:B,disabled:i||!h.trim(),children:i?"Creating...":"Create Key"})]})]})}),e.jsx(f,{isOpen:$,onClose:()=>g(!1),title:"API Key Created",children:l&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-yellow-900/30 border border-yellow-700 rounded p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-yellow-500 text-xl",children:"⚠️"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-400 font-semibold",children:"Save this key now!"}),e.jsx("p",{className:"text-yellow-300 text-sm",children:"This is the only time the full key will be shown. Store it securely."})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Your API Key"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:l.key,readOnly:!0,className:"flex-1 px-3 py-2 bg-gray-900 border border-gray-600 rounded text-cyan-400 font-mono text-sm"}),e.jsx(t,{onClick:()=>Y(l.key),children:"Copy"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Name:"}),e.jsx("p",{className:"text-white",children:l.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Rate Limit:"}),e.jsxs("p",{className:"text-white",children:[l.rate_limit,"/hour"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Discord Tag:"}),e.jsx("p",{className:"text-white",children:l.discord_tag||"None"})]})]}),e.jsxs("div",{className:"bg-gray-800 rounded p-4 text-sm",children:[e.jsx("p",{className:"text-gray-400 mb-2",children:"To use this key with the NMS Save Watcher companion app:"}),e.jsxs("ol",{className:"list-decimal list-inside text-gray-300 space-y-1",children:[e.jsx("li",{children:"Open the companion app's web dashboard"}),e.jsx("li",{children:"Go to Settings"}),e.jsx("li",{children:"Paste this API key in the API Key field"}),e.jsx("li",{children:"Save your settings"})]})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-700",children:e.jsx(t,{onClick:()=>g(!1),children:"I've Saved the Key"})})]})}),e.jsx(f,{isOpen:z,onClose:()=>y(!1),title:"Edit API Key",children:p&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Key Name *"}),e.jsx("input",{type:"text",value:c,onChange:s=>S(s.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Rate Limit (requests/hour)"}),e.jsx("input",{type:"number",value:I,onChange:s=>_(parseInt(s.target.value)||200),min:"1",max:"1000",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Discord Community Tag"}),e.jsxs("select",{value:T,onChange:s=>M(s.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",children:[e.jsx("option",{value:"",children:"-- No tag --"}),e.jsx("option",{value:"personal",children:"Personal"}),N.map(s=>e.jsxs("option",{value:s.tag,children:[s.name," (",s.tag,")"]},s.tag))]}),e.jsx("p",{className:"text-gray-500 text-xs mt-1",children:"Submissions via this key will be auto-tagged with this community"})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:[e.jsx("span",{className:"text-gray-500",children:"Key Prefix:"})," ",p.key_prefix,"..."]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-700",children:[e.jsx(t,{variant:"secondary",onClick:()=>y(!1),children:"Cancel"}),e.jsx(t,{onClick:U,disabled:i||!c.trim(),children:i?"Saving...":"Save Changes"})]})]})})]})}export{le as default};
