import{j as e,C as de,u as xe,b as se,O as me,L as ge,T as he,D as re,V as ne}from"./vendor-three-pXgRM845.js";import{b as t,L as ie}from"./vendor-react-DGfbrl1l.js";import{a as _}from"./vendor-ui-B9ygI19o.js";import{A as ue}from"./index-DgLtObAt.js";const U=.02,B={background:"#050508",grid:"#1a0a0a",gridLines:"#3d1515",accent:"#ef4444",contested:"#ff0000",hqGlow:"#fbbf24",defaultRegion:"#666666"};function pe({size:a=200}){return t.useRef(),e.jsxs("group",{children:[e.jsx("gridHelper",{args:[a,40,B.gridLines,B.grid],rotation:[0,0,0],position:[0,-50,0]}),e.jsx("gridHelper",{args:[a,80,B.grid,"transparent"],rotation:[0,0,0],position:[0,-50,0]})]})}function ye({position:a,color:y,size:m=.5}){const o=t.useRef();return se(c=>{const i=c.clock.elapsedTime,n=1+Math.sin(i*3)*.3;o.current&&(o.current.scale.set(n,n,n),o.current.material.opacity=.3+Math.sin(i*3)*.2)}),e.jsxs("mesh",{ref:o,position:a,children:[e.jsx("ringGeometry",{args:[m+.2,m+.4,32]}),e.jsx("meshBasicMaterial",{color:B.contested,transparent:!0,opacity:.5,side:re})]})}function be({position:a,color:y,name:m}){const o=t.useRef(),c=t.useRef();return se(i=>{const n=i.clock.elapsedTime;c.current&&(c.current.scale.set(1+Math.sin(n*2)*.15,1+Math.sin(n*2)*.15,1+Math.sin(n*2)*.15),c.current.material.opacity=.4+Math.sin(n*2)*.2)}),e.jsxs("group",{position:a,children:[e.jsxs("mesh",{ref:c,children:[e.jsx("sphereGeometry",{args:[.8,16,16]}),e.jsx("meshBasicMaterial",{color:B.hqGlow,transparent:!0,opacity:.4})]}),e.jsxs("mesh",{ref:o,children:[e.jsx("sphereGeometry",{args:[.5,16,16]}),e.jsx("meshBasicMaterial",{color:y||B.hqGlow})]}),e.jsxs("mesh",{position:[0,3,0],children:[e.jsx("cylinderGeometry",{args:[.05,.05,6,8]}),e.jsx("meshBasicMaterial",{color:B.hqGlow,transparent:!0,opacity:.3})]}),e.jsx(he,{position:[0,1.5,0],fontSize:.4,color:B.hqGlow,anchorX:"center",anchorY:"middle",outlineWidth:.02,outlineColor:"#000000",children:"HQ"})]})}function fe({region:a,isSelected:y,onSelect:m,onHover:o,onDoubleClick:c}){const i=t.useRef(),[n,p]=t.useState(!1),s=t.useMemo(()=>a.controlling_civ?.color||a.ownership?.owner?.color||B.defaultRegion,[a]),l=t.useMemo(()=>.25+Math.min((a.system_count||1)*.02,.25),[a]);se(x=>{if(i.current){i.current.position.y=Math.sin(x.clock.elapsedTime+a.region_x)*.05;const N=n||y?1.5:1;i.current.scale.lerp(new ne(N,N,N),.1)}});const r=t.useMemo(()=>[(a.region_x-2048)*U,(a.region_y-128)*U*2,(a.region_z-2048)*U],[a]);return e.jsxs("group",{position:r,children:[a.contested&&e.jsx(ye,{position:[0,0,0],color:s,size:l}),e.jsxs("mesh",{ref:i,onClick:x=>{x.stopPropagation(),m(a)},onDoubleClick:x=>{x.stopPropagation(),c&&c(a)},onPointerOver:x=>{x.stopPropagation(),p(!0),o(a),document.body.style.cursor="pointer"},onPointerOut:x=>{p(!1),o(null),document.body.style.cursor="auto"},children:[e.jsx("sphereGeometry",{args:[l,16,16]}),e.jsx("meshBasicMaterial",{color:s,transparent:!0,opacity:n||y?1:.85})]}),a.ownership&&a.ownership.percentage>50&&e.jsxs("mesh",{rotation:[Math.PI/2,0,0],children:[e.jsx("ringGeometry",{args:[l+.1,l+.15,32]}),e.jsx("meshBasicMaterial",{color:"#22d3d1",transparent:!0,opacity:.6,side:re})]}),y&&e.jsxs("mesh",{rotation:[Math.PI/2,0,0],children:[e.jsx("ringGeometry",{args:[l+.2,l+.25,32]}),e.jsx("meshBasicMaterial",{color:"#ffffff",transparent:!0,opacity:.8,side:re})]})]})}function je({regions:a,enrolledCivs:y}){const m=t.useMemo(()=>{const o=[];return y.forEach(c=>{const i=a.filter(n=>n.controlling_civ?.partner_id===c.partner_id||n.ownership?.owner?.partner_id===c.partner_id);for(let n=0;n<i.length;n++)for(let p=n+1;p<i.length;p++){const s=i[n],l=i[p],r=s.region_x-l.region_x,x=s.region_y-l.region_y,N=s.region_z-l.region_z;Math.sqrt(r*r+x*x+N*N)<500&&o.push({start:[(s.region_x-2048)*U,(s.region_y-128)*U*2,(s.region_z-2048)*U],end:[(l.region_x-2048)*U,(l.region_y-128)*U*2,(l.region_z-2048)*U],color:c.color||B.defaultRegion})}}),o},[a,y]);return e.jsx("group",{children:m.map((o,c)=>e.jsx(ge,{points:[o.start,o.end],color:o.color,lineWidth:1,transparent:!0,opacity:.2,dashed:!0,dashSize:2,gapSize:1},c))})}function ve({regions:a,homeRegions:y,enrolledCivs:m,selectedRegion:o,onSelectRegion:c,onHoverRegion:i,focusTarget:n,onFocusComplete:p,onRegionDrillDown:s}){const{camera:l}=xe(),r=t.useRef();return t.useEffect(()=>{l.position.set(20,30,40),l.lookAt(0,0,0)},[l]),se(()=>{if(n&&r.current){const x=new ne((n.region_x-2048)*U,(n.region_y-128)*U*2,(n.region_z-2048)*U);r.current.target.lerp(x,.08);const N=new ne(2,2,3),v=x.clone().add(N);l.position.lerp(v,.05),l.position.distanceTo(v)<.1&&p()}}),e.jsxs(e.Fragment,{children:[e.jsx("ambientLight",{intensity:.5}),e.jsx(pe,{size:100}),e.jsxs("mesh",{position:[0,0,0],children:[e.jsx("sphereGeometry",{args:[.2,16,16]}),e.jsx("meshBasicMaterial",{color:B.accent,transparent:!0,opacity:.8})]}),e.jsx(je,{regions:a,enrolledCivs:m}),y.map((x,N)=>e.jsx(be,{position:[(x.region_x-2048)*U,(x.region_y-128)*U*2,(x.region_z-2048)*U],color:x.civ?.color,name:x.civ?.display_name},`hq-${N}`)),a.map((x,N)=>e.jsx(fe,{region:x,isSelected:o?.region_x===x.region_x&&o?.region_y===x.region_y&&o?.region_z===x.region_z,onSelect:c,onHover:i,onDoubleClick:s},`region-${x.region_x}-${x.region_y}-${x.region_z}`)),e.jsx(me,{ref:r,enablePan:!0,enableZoom:!0,enableRotate:!0,minDistance:1,maxDistance:150,maxPolarAngle:Math.PI*.85,zoomSpeed:1.2})]})}function Ne({className:a="",onSystemSelect:y}){const[m,o]=t.useState(null),[c,i]=t.useState(!0),[n,p]=t.useState(null),[s,l]=t.useState(null),[r,x]=t.useState(null),[N,v]=t.useState(null),[w,C]=t.useState(null),[f,h]=t.useState([]),[R,T]=t.useState(!1);t.useEffect(()=>{const d=async()=>{try{p(null);const z=await _.get("/api/warroom/map-data");console.log("War Map 3D data:",z.data),o(z.data)}catch(z){console.error("Failed to fetch map data:",z),p(z.response?.data?.detail||"Failed to load map data")}finally{i(!1)}};d();const D=setInterval(d,3e4);return()=>clearInterval(D)},[]);const A=t.useCallback(async d=>{C(d),v(d),T(!0);try{const D=await _.get("/api/systems",{params:{region_x:d.region_x,region_y:d.region_y,region_z:d.region_z,limit:100}});h(D.data.systems||D.data||[])}catch(D){console.error("Failed to fetch region systems:",D),h([])}finally{T(!1)}},[]),L=t.useCallback(()=>{C(null),h([])},[]),{regions:F,homeRegions:j,enrolledCivs:k}=t.useMemo(()=>{if(!m)return{regions:[],homeRegions:[],enrolledCivs:[]};const d={},D=m.regions||[],z=m.home_regions||[],O=m.enrolled_civs||[];return D.forEach(E=>{if(E.region_x!=null&&E.region_y!=null&&E.region_z!=null){const u=`${E.region_x}:${E.region_y}:${E.region_z}`;d[u]=E}}),z.forEach(E=>{if(E.region_x!=null&&E.region_y!=null&&E.region_z!=null){const u=`${E.region_x}:${E.region_y}:${E.region_z}`;d[u]?d[u].is_home_region=!0:d[u]={region_x:E.region_x,region_y:E.region_y,region_z:E.region_z,region_name:E.region_name,galaxy:E.galaxy,controlling_civ:E.civ,system_count:0,contested:!1,is_home_region:!0}}}),{regions:Object.values(d),homeRegions:z.filter(E=>E.region_x!=null),enrolledCivs:O}},[m]);return c?e.jsx("div",{className:`h-full flex items-center justify-center bg-[#050508] ${a}`,children:e.jsx("div",{className:"text-red-400 animate-pulse text-lg",children:"Initializing War Map..."})}):n?e.jsx("div",{className:`h-full flex items-center justify-center bg-[#050508] ${a}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4 opacity-50",children:"âš ï¸"}),e.jsx("p",{className:"text-red-400 font-medium",children:"Map System Offline"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:n})]})}):!m||!k.length?e.jsx("div",{className:`h-full flex items-center justify-center bg-[#050508] ${a}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4 opacity-50",children:"ðŸŒŒ"}),e.jsx("p",{className:"text-gray-500",children:"No enrolled civilizations."}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Enroll civs in Admin to activate the war map."})]})}):e.jsxs("div",{className:`h-full relative bg-[#050508] ${a}`,children:[e.jsxs(de,{camera:{fov:60,near:.1,far:1e3},gl:{antialias:!0,alpha:!1},style:{background:B.background},children:[e.jsx("color",{attach:"background",args:[B.background]}),e.jsx("fog",{attach:"fog",args:[B.background,100,400]}),e.jsx(ve,{regions:F,homeRegions:j,enrolledCivs:k,selectedRegion:s,onSelectRegion:l,onHoverRegion:x,focusTarget:N,onFocusComplete:()=>v(null),onRegionDrillDown:A})]}),e.jsxs("div",{className:"absolute top-3 left-3 text-xs text-gray-400 bg-black/50 px-3 py-2 rounded",children:[e.jsx("span",{className:"text-white font-bold",children:k.length})," Civilizations â€¢",e.jsx("span",{className:"text-white font-bold ml-1",children:F.length})," Regions",m.active_conflict_count>0&&e.jsxs("span",{className:"text-red-400 animate-pulse ml-2",children:["â€¢ ",e.jsx("span",{className:"font-bold",children:m.active_conflict_count})," Active Conflict",m.active_conflict_count!==1?"s":""]})]}),e.jsxs("div",{className:"absolute top-14 left-3 bg-black/70 border border-gray-700 rounded p-2 text-xs",children:[e.jsx("div",{className:"text-gray-400 mb-2",children:"Quick Focus:"}),e.jsx("div",{className:"space-y-1",children:j.slice(0,5).map((d,D)=>e.jsxs("button",{onClick:()=>v({region_x:d.region_x,region_y:d.region_y,region_z:d.region_z}),className:"w-full text-left px-2 py-1 rounded hover:bg-red-900/30 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:d.civ?.color||"#666"}}),e.jsx("span",{className:"text-gray-300 truncate",children:d.civ?.display_name||"HQ"})]},D))})]}),e.jsxs("div",{className:"absolute bottom-3 left-3 text-xs text-gray-500 bg-black/50 px-3 py-2 rounded",children:[e.jsx("span",{className:"text-gray-400",children:"Controls:"})," Drag to rotate â€¢ Scroll to zoom â€¢ Right-drag to pan â€¢ Double-click to drill down"]}),e.jsxs("div",{className:"absolute top-3 right-3 bg-black/70 border border-red-500/30 rounded p-3 text-xs",children:[e.jsx("div",{className:"text-red-400 font-bold mb-2 text-sm",children:"LEGEND"}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-yellow-400 shadow-lg shadow-yellow-400/50"}),e.jsx("span",{className:"text-gray-300",children:"HQ (Headquarters)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-cyan-400 ring-1 ring-cyan-400"}),e.jsx("span",{className:"text-gray-300",children:"Owned (>50%)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-400"}),e.jsx("span",{className:"text-gray-300",children:"Claimed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500 animate-pulse"}),e.jsx("span",{className:"text-gray-300",children:"Contested"})]})]}),e.jsxs("div",{className:"mt-3 pt-2 border-t border-gray-700",children:[e.jsx("div",{className:"text-gray-400 mb-1",children:"Civilizations:"}),k.map(d=>e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:d.color||"#666"}}),e.jsx("span",{className:"text-gray-300 truncate max-w-[120px]",children:d.display_name})]},d.partner_id))]})]}),s&&!w&&e.jsxs("div",{className:"absolute bottom-3 right-3 bg-black/90 border border-red-500/30 rounded p-4 max-w-xs",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:s.controlling_civ?.color||s.ownership?.owner?.color||"#666"}}),e.jsx("span",{className:"font-bold text-white",children:s.region_name||`Region (${s.region_x}, ${s.region_y}, ${s.region_z})`})]}),e.jsx("button",{onClick:()=>l(null),className:"text-gray-400 hover:text-white",children:"âœ•"})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[s.is_home_region&&e.jsx("div",{className:"inline-block bg-yellow-500/20 text-yellow-400 text-xs px-2 py-0.5 rounded mb-1",children:"HEADQUARTERS"}),s.contested&&e.jsx("div",{className:"inline-block bg-red-500/20 text-red-400 text-xs px-2 py-0.5 rounded mb-1 ml-1 animate-pulse",children:"CONTESTED"}),s.ownership?e.jsxs("p",{className:"text-gray-400",children:["Owned by: ",e.jsx("span",{style:{color:s.ownership.owner?.color},className:"font-medium",children:s.ownership.owner?.display_name}),e.jsxs("span",{className:"text-gray-500",children:[" (",s.ownership.percentage,"%)"]})]}):s.controlling_civ?e.jsxs("p",{className:"text-gray-400",children:["Controlled by: ",e.jsx("span",{style:{color:s.controlling_civ.color},className:"font-medium",children:s.controlling_civ.display_name})]}):null,s.system_count>0&&e.jsxs("p",{className:"text-gray-500",children:[s.system_count," system",s.system_count!==1?"s":""]}),e.jsxs("p",{className:"text-gray-600 text-xs mt-2",children:["Coords: (",s.region_x,", ",s.region_y,", ",s.region_z,")",s.galaxy&&` â€¢ ${s.galaxy}`]}),e.jsx("button",{onClick:()=>A(s),className:"mt-3 w-full px-3 py-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/50 rounded text-red-400 text-sm font-medium transition-colors",children:"View Systems â†’"})]})]}),w&&e.jsxs("div",{className:"absolute bottom-3 right-3 bg-black/95 border border-red-500/30 rounded p-4 w-80 max-h-[400px] flex flex-col",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:w.controlling_civ?.color||w.ownership?.owner?.color||"#666"}}),e.jsx("span",{className:"font-bold text-white text-sm",children:w.region_name||"Region"})]}),e.jsxs("p",{className:"text-gray-500 text-xs mt-1",children:["(",w.region_x,", ",w.region_y,", ",w.region_z,")"]})]}),e.jsx("button",{onClick:L,className:"text-gray-400 hover:text-white text-lg",children:"âœ•"})]}),e.jsx("div",{className:"text-red-400 text-xs font-bold mb-2 uppercase tracking-wider",children:"Systems in Region"}),e.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:R?e.jsx("div",{className:"text-gray-500 text-center py-4 animate-pulse",children:"Loading systems..."}):f.length===0?e.jsx("div",{className:"text-gray-500 text-center py-4",children:"No systems found in this region"}):e.jsx("div",{className:"space-y-2",children:f.map((d,D)=>e.jsxs("button",{onClick:()=>y?.(d),className:"w-full text-left p-2 bg-gray-900/50 hover:bg-red-500/20 border border-gray-700/50 hover:border-red-500/50 rounded transition-colors group",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white text-sm font-medium truncate group-hover:text-red-300",children:d.system_name||d.name||"Unknown System"}),d.discord_tag&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded ml-2 flex-shrink-0",style:{backgroundColor:`${k.find(z=>z.discord_tag===d.discord_tag)?.color||"#666"}30`,color:k.find(z=>z.discord_tag===d.discord_tag)?.color||"#666"},children:d.discord_tag})]}),d.glyph_code&&e.jsx("p",{className:"text-gray-500 text-xs mt-0.5 font-mono",children:d.glyph_code})]},d.id||D))})}),f.length>0&&e.jsxs("div",{className:"text-gray-500 text-xs mt-2 pt-2 border-t border-gray-700",children:[f.length," system",f.length!==1?"s":""," â€¢ Click to select for war declaration"]})]}),r&&!s&&e.jsxs("div",{className:"absolute bottom-16 left-1/2 -translate-x-1/2 bg-black/90 border border-gray-700 rounded px-3 py-2 text-sm pointer-events-none",children:[e.jsx("span",{className:"text-white",children:r.region_name||`Region (${r.region_x}, ${r.region_y}, ${r.region_z})`}),(r.controlling_civ||r.ownership?.owner)&&e.jsx("span",{className:"ml-2",style:{color:r.controlling_civ?.color||r.ownership?.owner?.color},children:r.controlling_civ?.display_name||r.ownership?.owner?.display_name})]})]})}function H({children:a,className:y="",title:m,danger:o=!1}){return e.jsxs("div",{className:`
      rounded-lg border backdrop-blur-sm flex flex-col
      ${o?"bg-red-950/40 border-red-500/30":"bg-gray-900/80 border-red-500/20"}
      ${y}
    `,children:[m&&e.jsx("div",{className:"px-4 py-2 border-b border-red-500/20 flex-shrink-0",children:e.jsx("h3",{className:"text-sm font-bold text-red-400 uppercase tracking-wider",children:m})}),e.jsx("div",{className:"p-4 flex-1 min-h-0",children:a})]})}function we({conflict:a}){const y={pending:"bg-yellow-500",acknowledged:"bg-orange-500",active:"bg-red-500 animate-pulse",resolved:"bg-gray-500"};return e.jsxs("div",{className:"bg-gray-800/50 rounded border border-red-500/20 p-3 mb-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-bold ${y[a.status]} text-white`,children:a.status.toUpperCase()}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(a.declared_at).toLocaleDateString()})]}),e.jsxs("div",{className:"text-sm mb-1",children:[e.jsx("span",{style:{color:a.attacker_color},className:"font-bold",children:a.attacker_name}),e.jsx("span",{className:"text-gray-500 mx-2",children:"vs"}),e.jsx("span",{style:{color:a.defender_color},className:"font-bold",children:a.defender_name})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Target: ",e.jsx("span",{className:"text-white",children:a.target_system_name})]})]})}function _e({news:a}){return a.length?e.jsx("div",{className:"bg-gray-900/90 border-b border-red-500/30 py-2 overflow-hidden",children:e.jsx("div",{className:"flex animate-marquee whitespace-nowrap",children:a.concat(a).map((y,m)=>e.jsxs("span",{className:"mx-8 text-sm",children:[e.jsx("span",{className:"text-red-400 font-bold mr-2",children:"BREAKING:"}),e.jsx("span",{className:"text-gray-300",children:y.headline})]},m))})}):null}function Ce({debrief:a,onUpdate:y,canEdit:m}){const[o,c]=t.useState(!1),[i,n]=t.useState([]);t.useEffect(()=>{n(a.objectives||[])},[a]);const p=async()=>{await y(i),c(!1)};return e.jsx(H,{title:"Current Mission Debrief",danger:!0,children:o?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{className:"w-full bg-gray-800 border border-red-500/30 rounded p-2 text-sm text-gray-200",rows:4,value:i.join(`
`),onChange:s=>n(s.target.value.split(`
`).filter(Boolean)),placeholder:"Enter objectives, one per line..."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:p,className:"px-3 py-1 bg-red-600 hover:bg-red-500 rounded text-sm font-bold",children:"Save"}),e.jsx("button",{onClick:()=>c(!1),className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-sm",children:"Cancel"})]})]}):e.jsxs("div",{children:[i.length>0?e.jsx("ul",{className:"space-y-1",children:i.map((s,l)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsxs("span",{className:"text-red-400 font-bold",children:[l+1,"."]}),e.jsx("span",{className:"text-gray-200",children:s})]},l))}):e.jsx("p",{className:"text-gray-500 text-sm italic",children:"No current objectives set."}),m&&e.jsx("button",{onClick:()=>c(!0),className:"mt-3 text-xs text-red-400 hover:text-red-300",children:"Edit Objectives"}),a.updated_at&&e.jsxs("p",{className:"mt-2 text-xs text-gray-500",children:["Last updated: ",new Date(a.updated_at).toLocaleString()," by ",a.updated_by]})]})})}function Se({leaderboard:a,activeConflicts:y=[]}){const[m,o]=t.useState(null),c=i=>{const n=y.filter(l=>l.attacker_partner_id===i.partner_id||l.defender_partner_id===i.partner_id),p=n.filter(l=>l.attacker_partner_id===i.partner_id).length,s=n.filter(l=>l.defender_partner_id===i.partner_id).length;return{activeWars:n.length,attacking:p,defending:s}};return e.jsx(H,{title:"Civilization Rankings",children:a.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No enrolled civilizations yet."}):e.jsx("div",{className:"space-y-2",children:a.map((i,n)=>{const p=c(i),s=m===i.partner_id;return e.jsxs("div",{className:`bg-gray-800/50 rounded overflow-hidden transition-all ${s?"ring-1 ring-red-500/50":""}`,children:[e.jsxs("div",{onClick:()=>o(s?null:i.partner_id),className:"flex items-center justify-between p-2 cursor-pointer hover:bg-gray-800/70",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`text-lg font-bold ${n===0?"text-yellow-400":n===1?"text-gray-300":n===2?"text-amber-600":"text-gray-500"}`,children:["#",n+1]}),e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:i.color}}),e.jsx("span",{className:"font-medium text-gray-200",children:i.display_name}),p.activeWars>0&&e.jsxs("span",{className:"text-xs px-1.5 py-0.5 bg-red-500/20 text-red-400 rounded animate-pulse",children:[p.activeWars," war",p.activeWars>1?"s":""]})]}),e.jsxs("div",{className:"flex gap-3 text-xs",children:[e.jsxs("div",{className:"text-center min-w-[50px]",children:[e.jsx("div",{className:"text-gray-500 text-[10px]",children:"Systems"}),e.jsx("div",{className:"font-bold text-green-400",children:i.systems_controlled||0})]}),e.jsxs("div",{className:"text-center min-w-[50px]",children:[e.jsx("div",{className:"text-gray-500 text-[10px]",children:"Victories"}),e.jsx("div",{className:"font-bold text-red-400",children:i.systems_conquered||0})]}),e.jsxs("div",{className:"text-center min-w-[50px]",children:[e.jsx("div",{className:"text-gray-500 text-[10px]",children:"Win Rate"}),e.jsxs("div",{className:"font-bold text-yellow-400",children:[i.win_rate||0,"%"]})]})]})]}),s&&e.jsxs("div",{className:"px-3 pb-3 pt-1 border-t border-gray-700 bg-gray-900/50",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-center text-xs",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Wars Won"}),e.jsx("div",{className:"font-bold text-green-400",children:i.wars_won||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Wars Lost"}),e.jsx("div",{className:"font-bold text-red-400",children:i.wars_lost||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Attacking"}),e.jsx("div",{className:"font-bold text-orange-400",children:p.attacking})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Defending"}),e.jsx("div",{className:"font-bold text-blue-400",children:p.defending})]})]}),i.last_war_date&&e.jsxs("div",{className:"text-xs text-gray-500 mt-2 text-center",children:["Last conflict: ",new Date(i.last_war_date).toLocaleDateString()]})]})]},i.partner_id)})})})}function ke({stats:a}){const y={longest_defense:{label:"Longest Defense",icon:"ðŸ›¡ï¸"},fastest_invasion:{label:"Fastest Invasion",icon:"âš”ï¸"},largest_battle:{label:"Largest Battle",icon:"ðŸ’¥"},most_conquered:{label:"Most Conquests",icon:"ðŸ‘‘"}};return e.jsx(H,{title:"War Records",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(y).map(([m,{label:o,icon:c}])=>{const i=a[m];return e.jsxs("div",{className:"bg-gray-800/50 rounded p-2 text-center",children:[e.jsx("div",{className:"text-lg mb-1",children:c}),e.jsx("div",{className:"text-xs text-gray-400",children:o}),i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-bold text-white",children:[i.value," ",i.unit]}),e.jsx("div",{className:"text-xs text-red-400",children:i.holder||"N/A"})]}):e.jsx("div",{className:"text-xs text-gray-500 italic",children:"No record yet"})]},m)})})})}const oe=[{id:"expansion",label:"Expansion",icon:"ðŸ´",desc:"Expand your territory"},{id:"revenge",label:"Revenge",icon:"âš”ï¸",desc:"Retaliation for past aggression"},{id:"border_dispute",label:"Border Dispute",icon:"ðŸ—ºï¸",desc:"Contested territory claim"},{id:"economic",label:"Economic",icon:"ðŸ’°",desc:"Control valuable resources"},{id:"liberation",label:"Liberation",icon:"ðŸ•Šï¸",desc:"Free the system from occupation"}];function Re({open:a,onClose:y,onSuccess:m,claims:o,isSuperAdmin:c,enrolledCivs:i,myPartnerId:n,preSelectedSystem:p,onClearPreSelected:s}){const[l,r]=t.useState(null),[x,N]=t.useState(""),[v,w]=t.useState(!1),[C,f]=t.useState(null),[h,R]=t.useState(""),[T,A]=t.useState("all"),[L,F]=t.useState("expansion"),[j,k]=t.useState(!1);if(t.useEffect(()=>{if(p&&a&&o.length>0){const u=o.find(M=>M.system_id===p.id);u&&(r(u),A(u.claimant_partner_id.toString()))}},[p,a,o]),t.useEffect(()=>{a||(r(null),N(""),R(""),A("all"),k(!1),s?.())},[a,s]),!a)return null;const d=c?parseInt(x):n;let D=o.filter(u=>u.claimant_partner_id!==d);if(h){const u=h.toLowerCase();D=D.filter(M=>(M.system_name||"").toLowerCase().includes(u)||(M.region_name||"").toLowerCase().includes(u)||(M.claimant_display_name||"").toLowerCase().includes(u))}T!=="all"&&(D=D.filter(u=>u.claimant_partner_id===parseInt(T)));const z=[...new Map(o.filter(u=>u.claimant_partner_id!==d).map(u=>[u.claimant_partner_id,{id:u.claimant_partner_id,name:u.claimant_display_name,color:u.claimant_color}])).values()],O=D.reduce((u,M)=>{const b=M.claimant_display_name;return u[b]||(u[b]={color:M.claimant_color,partnerId:M.claimant_partner_id,claims:[]}),u[b].claims.push(M),u},{}),E=async()=>{if(!l){f("Please select a target system");return}if(c&&!x){f("Please select an attacking civilization");return}w(!0),f(null);try{const u={target_system_id:l.system_id,war_goal:L,is_practice:j};c&&(u.attacker_partner_id=parseInt(x)),await _.post("/api/warroom/conflicts",u),m(),y(),r(null),N(""),R(""),A("all"),k(!1)}catch(u){f(u.response?.data?.detail||"Failed to declare attack")}finally{w(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-900 border border-red-500/30 rounded-lg p-6 w-full max-w-lg max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx("h2",{className:"text-xl font-bold text-red-500 mb-4",children:"âš”ï¸ DECLARE WAR"}),C&&e.jsx("p",{className:"text-red-400 text-sm mb-4 p-2 bg-red-950/30 rounded",children:C}),c&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Attacking Civilization"}),e.jsxs("select",{value:x,onChange:u=>{N(u.target.value),r(null)},className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"-- Select attacking civilization --"}),i.map(u=>e.jsx("option",{value:u.partner_id,children:u.display_name},u.partner_id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"War Goal (Casus Belli)"}),e.jsx("div",{className:"grid grid-cols-5 gap-1",children:oe.map(u=>e.jsxs("button",{onClick:()=>F(u.id),className:`p-2 rounded text-center transition-all ${L===u.id?"bg-red-600 border-2 border-red-400":"bg-gray-800 border border-gray-700 hover:border-red-500/50"}`,title:u.desc,children:[e.jsx("div",{className:"text-lg",children:u.icon}),e.jsx("div",{className:"text-[10px] text-gray-300 truncate",children:u.label})]},u.id))})]}),l&&e.jsx("div",{className:"mb-4 bg-red-950/50 border border-red-500/50 rounded p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-red-400 uppercase font-bold",children:"Target Selected"}),e.jsx("div",{className:"font-bold text-white",children:l.system_name||l.system_id}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Region (",l.region_x,", ",l.region_y,", ",l.region_z,")"," ","â€¢"," ",l.galaxy]}),e.jsxs("div",{className:"text-xs mt-1",children:["Controlled by: ",e.jsx("span",{style:{color:l.claimant_color},children:l.claimant_display_name})]})]}),e.jsx("button",{onClick:()=>r(null),className:"text-gray-400 hover:text-white text-sm",children:"Change"})]})}),!l&&e.jsxs("div",{className:"mb-4 flex-1 overflow-hidden flex flex-col",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Select Target System"}),c&&!x?e.jsx("p",{className:"text-gray-500 text-sm text-center py-8",children:"Select an attacking civilization first"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("input",{type:"text",value:h,onChange:u=>R(u.target.value),placeholder:"Search systems...",className:"flex-1 bg-gray-800 border border-gray-600 rounded px-3 py-1.5 text-sm"}),e.jsxs("select",{value:T,onChange:u=>A(u.target.value),className:"bg-gray-800 border border-gray-600 rounded px-2 py-1.5 text-sm",children:[e.jsx("option",{value:"all",children:"All Enemies"}),z.map(u=>e.jsx("option",{value:u.id,children:u.name},u.id))]})]}),Object.keys(O).length===0?e.jsx("p",{className:"text-gray-500 text-sm text-center py-8",children:h||T!=="all"?"No matching targets":"No enemy territories to attack"}):e.jsx("div",{className:"flex-1 overflow-y-auto space-y-3 pr-2",children:Object.entries(O).map(([u,{color:M,claims:b}])=>e.jsxs("div",{className:"bg-gray-800/50 rounded border border-gray-700",children:[e.jsxs("div",{className:"px-3 py-2 border-b border-gray-700 flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:M}}),e.jsx("span",{className:"text-sm font-medium",style:{color:M},children:u}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",b.length," systems)"]})]}),e.jsx("div",{className:"p-2 space-y-1 max-h-40 overflow-y-auto",children:b.map(P=>e.jsxs("button",{onClick:()=>r(P),className:"w-full text-left px-3 py-2 rounded hover:bg-red-900/30 border border-transparent hover:border-red-500/50 transition-colors",children:[e.jsx("div",{className:"font-medium text-white text-sm",children:P.system_name||P.system_id}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Region (",P.region_x,", ",P.region_y,", ",P.region_z,") â€¢ ",P.galaxy]})]},P.id))})]},u))})]})]}),e.jsx("div",{className:"mb-4 p-3 rounded border border-dashed border-cyan-500/30 bg-cyan-950/20",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:u=>k(u.target.checked),className:"w-4 h-4 rounded bg-gray-700 border-gray-600 text-cyan-500 focus:ring-cyan-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-cyan-400 font-medium",children:"Practice Mode"}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:"Test war mechanics without affecting real stats or sending notifications"})]})]})}),e.jsxs("div",{className:"flex gap-3 pt-2 border-t border-gray-700",children:[e.jsx("button",{onClick:E,disabled:v||!l,className:`flex-1 py-2 ${j?"bg-cyan-600 hover:bg-cyan-500":"bg-red-600 hover:bg-red-500"} disabled:bg-gray-600 disabled:cursor-not-allowed rounded font-bold`,children:v?"Declaring...":j?"ðŸŽ¯ START PRACTICE WAR":`âš”ï¸ DECLARE WAR (${oe.find(u=>u.id===L)?.label})`}),e.jsx("button",{onClick:y,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded",children:"Cancel"})]})]})})}function Ee({open:a,onClose:y,onSuccess:m,isSuperAdmin:o,enrolledCivs:c}){const[i,n]=t.useState(""),[p,s]=t.useState([]),[l,r]=t.useState(null),[x,N]=t.useState(""),[v,w]=t.useState(""),[C,f]=t.useState(!1),[h,R]=t.useState(!1),[T,A]=t.useState(null),L=t.useRef(null);if(t.useEffect(()=>{if(a){if(i.length<2){s([]);return}return L.current&&clearTimeout(L.current),L.current=setTimeout(async()=>{R(!0);try{const d=await _.get(`/api/systems/search?q=${encodeURIComponent(i)}&limit=20`);s(d.data.results||[])}catch(d){console.error("Search failed:",d),s([])}finally{R(!1)}},300),()=>{L.current&&clearTimeout(L.current)}}},[i,a]),!a)return null;const F=async()=>{if(!l){A("Please select a system to claim");return}if(o&&!x){A("Please select a civilization");return}f(!0),A(null);try{const d={system_id:l.id,notes:v};o&&(d.partner_id=parseInt(x)),await _.post("/api/warroom/claims",d),m(),y(),n(""),r(null),N(""),w(""),s([])}catch(d){A(d.response?.data?.detail||"Failed to claim territory")}finally{f(!1)}},j=d=>{r(d),n(""),s([])},k=()=>{r(null)};return e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-900 border border-green-500/30 rounded-lg p-6 w-full max-w-lg",children:[e.jsx("h2",{className:"text-xl font-bold text-green-500 mb-4",children:"CLAIM TERRITORY"}),T&&e.jsx("p",{className:"text-red-400 text-sm mb-4",children:T}),o&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Claiming Civilization"}),e.jsxs("select",{value:x,onChange:d=>N(d.target.value),className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"-- Select civilization --"}),c.map(d=>e.jsx("option",{value:d.partner_id,children:d.display_name},d.partner_id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Search System"}),l?e.jsx("div",{className:"bg-gray-800 border border-green-500/50 rounded p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-green-400",children:l.name}),e.jsxs("div",{className:"text-xs text-gray-400",children:[l.region_name||`Region (${l.region_x}, ${l.region_y}, ${l.region_z})`," ","â€¢"," ",l.galaxy,l.discord_tag&&e.jsxs("span",{className:"ml-1 text-cyan-400",children:["(",l.discord_tag,")"]})]}),l.glyph_code&&e.jsx("div",{className:"text-xs text-gray-500 font-mono mt-1",children:l.glyph_code})]}),e.jsx("button",{onClick:k,className:"text-red-400 hover:text-red-300 text-sm",children:"Change"})]})}):e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:i,onChange:d=>n(d.target.value),placeholder:"Type system name, glyph code, or region...",className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-sm"}),h&&e.jsx("div",{className:"absolute right-3 top-2 text-gray-400 text-sm",children:"Searching..."}),p.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-gray-800 border border-gray-600 rounded shadow-lg max-h-60 overflow-y-auto",children:p.map(d=>e.jsxs("button",{onClick:()=>j(d),className:"w-full text-left px-3 py-2 hover:bg-gray-700 border-b border-gray-700 last:border-b-0",children:[e.jsx("div",{className:"font-medium text-white",children:d.name}),e.jsxs("div",{className:"text-xs text-gray-400",children:[d.region_name||`(${d.region_x}, ${d.region_y}, ${d.region_z})`," ","â€¢"," ",d.galaxy,d.discord_tag&&e.jsxs("span",{className:"ml-1 text-cyan-400",children:["(",d.discord_tag,")"]})]})]},d.id))}),i.length>=2&&!h&&p.length===0&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-gray-800 border border-gray-600 rounded p-3 text-center text-gray-400 text-sm",children:['No systems found matching "',i,'"']})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Search for cataloged systems by name, glyph code, or region"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Notes (optional)"}),e.jsx("textarea",{value:v,onChange:d=>w(d.target.value),placeholder:"Strategic importance, resources, etc.",className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-sm",rows:2})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:F,disabled:C,className:"flex-1 py-2 bg-green-600 hover:bg-green-500 disabled:bg-gray-600 rounded font-bold",children:C?"Claiming...":"CLAIM TERRITORY"}),e.jsx("button",{onClick:y,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded",children:"Cancel"})]})]})})}function Ae({open:a,onClose:y,onSuccess:m,partnerId:o}){const[c,i]=t.useState(""),[n,p]=t.useState([]),[s,l]=t.useState(null),[r,x]=t.useState({region_x:"",region_y:"",region_z:"",region_name:"",galaxy:"Euclid"}),[N,v]=t.useState(!1),[w,C]=t.useState(!1),[f,h]=t.useState(null),[R,T]=t.useState("search"),A=t.useRef(null);t.useEffect(()=>{a||(i(""),p([]),l(null),h(null),T("search"))},[a]),t.useEffect(()=>{if(!(!a||R!=="search")){if(c.length<2){p([]);return}return A.current&&clearTimeout(A.current),A.current=setTimeout(async()=>{C(!0);try{const j=await _.get(`/api/warroom/region-search?search=${encodeURIComponent(c)}&limit=15`);p(j.data||[])}catch(j){console.error("Region search failed:",j),p([])}finally{C(!1)}},300),()=>{A.current&&clearTimeout(A.current)}}},[c,a,R]);const L=j=>{l(j),i(""),p([])},F=async()=>{v(!0),h(null);try{let j;if(R==="manual"||s)if(R==="manual"){if(!r.region_x||!r.region_y||!r.region_z){h("Please enter all coordinates"),v(!1);return}j={region_x:parseInt(r.region_x),region_y:parseInt(r.region_y),region_z:parseInt(r.region_z),region_name:r.region_name||null,galaxy:r.galaxy}}else j={region_x:s.region_x,region_y:s.region_y,region_z:s.region_z,region_name:s.name||s.region_name,galaxy:s.galaxy||"Euclid"};else{h("Please select or enter a home region"),v(!1);return}await _.put(`/api/warroom/enrollment/${o}/home-region`,j),m(),y()}catch(j){h(j.response?.data?.detail||"Failed to set home region")}finally{v(!1)}};return a?e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-900 border border-cyan-500/30 rounded-lg p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold text-cyan-400 mb-4",children:"Set Home Region (HQ)"}),f&&e.jsx("p",{className:"text-red-400 text-sm mb-4 p-2 bg-red-950/30 rounded",children:f}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("button",{onClick:()=>T("search"),className:`flex-1 py-2 rounded text-sm font-medium ${R==="search"?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300"}`,children:"Search Regions"}),e.jsx("button",{onClick:()=>T("manual"),className:`flex-1 py-2 rounded text-sm font-medium ${R==="manual"?"bg-cyan-600 text-white":"bg-gray-700 text-gray-300"}`,children:"Enter Coordinates"})]}),R==="search"?e.jsxs(e.Fragment,{children:[s&&e.jsx("div",{className:"mb-4 p-3 bg-cyan-950/30 border border-cyan-500/50 rounded",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-cyan-400 font-medium",children:s.name||s.region_name||"Unnamed Region"}),e.jsxs("div",{className:"text-xs text-gray-400",children:["(",s.region_x,", ",s.region_y,", ",s.region_z,") - ",s.galaxy||"Euclid"]})]}),e.jsx("button",{onClick:()=>l(null),className:"text-gray-400 hover:text-white",children:"Change"})]})}),!s&&e.jsxs("div",{className:"mb-4 relative",children:[e.jsx("input",{type:"text",value:c,onChange:j=>i(j.target.value),placeholder:"Search regions by name...",className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-sm"}),w&&e.jsx("div",{className:"absolute right-3 top-2 text-gray-400 text-sm",children:"Searching..."}),n.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-gray-800 border border-gray-600 rounded shadow-lg max-h-64 overflow-y-auto",children:n.map((j,k)=>e.jsxs("button",{onClick:()=>L(j),className:"w-full text-left px-3 py-2 hover:bg-gray-700 border-b border-gray-700 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium text-white",children:j.name||j.region_name||`Region (${j.region_x}, ${j.region_y}, ${j.region_z})`}),j.system_count>0&&e.jsxs("span",{className:"text-xs text-cyan-400",children:[j.system_count," systems"]})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["(",j.region_x,", ",j.region_y,", ",j.region_z,") - ",j.galaxy||"Euclid",j.source==="system_match"&&j.sample_systems&&e.jsxs("span",{className:"ml-1 text-gray-500",children:["â€¢ Contains: ",j.sample_systems]})]})]},k))}),c.length>=2&&!w&&n.length===0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-gray-800 border border-gray-600 rounded p-3 text-sm text-gray-400",children:"No regions found. Try searching by system name or enter coordinates manually."})]})]}):e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"X"}),e.jsx("input",{type:"number",value:r.region_x,onChange:j=>x(k=>({...k,region_x:j.target.value})),className:"w-full bg-gray-800 border border-gray-600 rounded px-2 py-1.5 text-sm",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Y"}),e.jsx("input",{type:"number",value:r.region_y,onChange:j=>x(k=>({...k,region_y:j.target.value})),className:"w-full bg-gray-800 border border-gray-600 rounded px-2 py-1.5 text-sm",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Z"}),e.jsx("input",{type:"number",value:r.region_z,onChange:j=>x(k=>({...k,region_z:j.target.value})),className:"w-full bg-gray-800 border border-gray-600 rounded px-2 py-1.5 text-sm",placeholder:"0"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Region Name (optional)"}),e.jsx("input",{type:"text",value:r.region_name,onChange:j=>x(k=>({...k,region_name:j.target.value})),className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-sm",placeholder:"Your home region name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Galaxy"}),e.jsxs("select",{value:r.galaxy,onChange:j=>x(k=>({...k,galaxy:j.target.value})),className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-sm",children:[e.jsx("option",{value:"Euclid",children:"Euclid"}),e.jsx("option",{value:"Hilbert Dimension",children:"Hilbert Dimension"}),e.jsx("option",{value:"Calypso",children:"Calypso"}),e.jsx("option",{value:"Hesperius Dimension",children:"Hesperius Dimension"}),e.jsx("option",{value:"Hyades",children:"Hyades"}),e.jsx("option",{value:"Eissentam",children:"Eissentam"})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{onClick:F,disabled:N||R==="search"&&!s,className:"flex-1 py-2 bg-cyan-600 hover:bg-cyan-500 disabled:bg-gray-600 disabled:cursor-not-allowed rounded font-bold",children:N?"Saving...":"Set Home Region"}),e.jsx("button",{onClick:y,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded",children:"Cancel"})]})]})}):null}function ce({maxItems:a=15,onConflictClick:y}){const[m,o]=t.useState([]),[c,i]=t.useState(!0);t.useEffect(()=>{const s=async()=>{try{const r=await _.get(`/api/warroom/activity-feed?limit=${a}`);o(r.data)}catch(r){console.error("Failed to fetch activity feed:",r)}finally{i(!1)}};s();const l=setInterval(s,15e3);return()=>clearInterval(l)},[a]);const n=s=>({war_declared:"âš”ï¸",conflict_acknowledged:"ðŸ¤",conflict_resolved:"ðŸ†",conflict_cancelled:"ðŸ³ï¸",battle_skirmish:"ðŸ’¥",battle_capture:"ðŸŽ¯",battle_defense:"ðŸ›¡ï¸",battle_retreat:"ðŸƒ",battle_reinforcement:"ðŸ“¢",ally_joined:"ðŸ¤",resolution_proposed:"ðŸ“",resolution_agreed:"âœ…",territory_claimed:"ðŸ“",news_published:"ðŸ“°",surrender:"ðŸ³ï¸",peace_proposed:"ðŸ•Šï¸"})[s]||"ðŸ“Œ",p=s=>s.includes("battle")?"border-orange-500/30 bg-orange-950/20 hover:bg-orange-900/30":s.includes("resolved")||s.includes("agreed")?"border-green-500/30 bg-green-950/20 hover:bg-green-900/30":s.includes("declared")||s.includes("war")?"border-red-500/30 bg-red-950/20 hover:bg-red-900/30":s.includes("cancelled")||s.includes("surrender")?"border-gray-500/30 bg-gray-950/20 hover:bg-gray-800/30":s.includes("peace")||s.includes("ally")?"border-amber-500/30 bg-amber-950/20 hover:bg-amber-900/30":"border-yellow-500/30 bg-yellow-950/20 hover:bg-yellow-900/30";return c?e.jsx(H,{title:"Live Activity Feed",children:e.jsx("div",{className:"text-center py-8 text-gray-400 animate-pulse",children:"Loading activity..."})}):e.jsx(H,{title:"Live Activity Feed",children:m.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No recent activity"}):e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto pr-2",children:m.map(s=>e.jsx("div",{onClick:()=>s.conflict_id&&y?.(s.conflict_id),className:`p-3 rounded border transition-colors ${p(s.event_type)} ${s.conflict_id?"cursor-pointer":""}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:n(s.event_type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-white text-sm",children:s.actor_name&&s.actor_color?e.jsxs("span",{children:[e.jsx("span",{style:{color:s.actor_color},children:s.actor_name}),s.headline.replace(s.actor_name,"")]}):s.headline}),s.details&&e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:s.details}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500",children:[e.jsx("span",{children:new Date(s.created_at).toLocaleString()}),s.system_name&&e.jsxs("span",{className:"text-cyan-400",children:["@ ",s.system_name]}),s.conflict_id&&e.jsx("span",{className:"text-red-400 text-[10px]",children:"Click to view â†’"})]})]})]})},s.id))})})}function De({count:a,onRead:y}){const[m,o]=t.useState(!1),[c,i]=t.useState([]),[n,p]=t.useState(!1),s=async()=>{p(!0);try{const r=await _.get("/api/warroom/notifications?limit=20");i(r.data)}catch(r){console.error("Failed to fetch notifications:",r)}finally{p(!1)}},l=async()=>{try{await _.put("/api/warroom/notifications/read-all"),i(r=>r.map(x=>({...x,read_at:new Date().toISOString()}))),y?.()}catch(r){console.error("Failed to mark notifications read:",r)}};return t.useEffect(()=>{m&&s()},[m]),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>o(!m),className:"flex items-center gap-1 px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-sm",children:[e.jsx("span",{children:"ðŸ””"}),a>0&&e.jsx("span",{className:"bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center",children:a>9?"9+":a})]}),m&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>o(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-80 bg-gray-900 border border-red-500/30 rounded-lg shadow-xl z-50",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-gray-700",children:[e.jsx("span",{className:"font-bold text-red-400",children:"War Alerts"}),c.length>0&&e.jsx("button",{onClick:l,className:"text-xs text-gray-400 hover:text-white",children:"Mark all read"})]}),e.jsx("div",{className:"max-h-80 overflow-y-auto",children:n?e.jsx("div",{className:"p-4 text-center text-gray-400",children:"Loading..."}):c.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No notifications"}):c.map(r=>e.jsxs("div",{className:`p-3 border-b border-gray-800 ${r.read_at?"":"bg-red-950/20"}`,children:[e.jsx("div",{className:"font-medium text-sm text-white",children:r.title}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:r.message}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:new Date(r.created_at).toLocaleString()})]},r.id))})]})]})]})}function Te({isEnrolled:a}){const[y,m]=t.useState(null),[o,c]=t.useState(""),[i,n]=t.useState(!0),[p,s]=t.useState(!0),[l,r]=t.useState(!1),[x,N]=t.useState(null),[v,w]=t.useState(!1);t.useEffect(()=>{if(!a)return;(async()=>{try{const R=await _.get("/api/warroom/webhooks");m(R.data),n(R.data.is_active!==!1)}catch(R){console.error("Failed to fetch webhook config:",R)}finally{s(!1)}})()},[a]);const C=async()=>{r(!0),N(null);try{await _.put("/api/warroom/webhooks",{webhook_url:o||null,is_active:i}),N({type:"success",text:"Webhook saved!"}),c("");const h=await _.get("/api/warroom/webhooks");m(h.data)}catch(h){N({type:"error",text:h.response?.data?.detail||"Failed to save webhook"})}finally{r(!1)}},f=async()=>{if(confirm("Remove Discord webhook notifications?")){r(!0);try{await _.delete("/api/warroom/webhooks"),m({configured:!1}),N({type:"success",text:"Webhook removed"})}catch{N({type:"error",text:"Failed to remove webhook"})}finally{r(!1)}}};return!a||p?null:e.jsx(H,{title:"Discord Notifications",children:v?e.jsxs("div",{className:"space-y-3",children:[x&&e.jsx("div",{className:`text-xs p-2 rounded ${x.type==="success"?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:x.text}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Discord Webhook URL"}),e.jsx("input",{type:"text",value:o,onChange:h=>c(h.target.value),placeholder:"https://discord.com/api/webhooks/...",className:"w-full bg-gray-800 border border-gray-600 rounded px-2 py-1.5 text-xs"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:y?.configured?`Current: ${y.webhook_url||"configured"}`:"Create a webhook in your Discord server settings"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:i,onChange:h=>n(h.target.checked),className:"rounded"}),e.jsx("span",{className:"text-gray-300",children:"Notifications enabled"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:C,disabled:l,className:"flex-1 py-1.5 bg-cyan-600 hover:bg-cyan-500 disabled:bg-gray-600 rounded text-xs font-bold",children:l?"Saving...":"Save"}),y?.configured&&e.jsx("button",{onClick:f,disabled:l,className:"px-3 py-1.5 bg-red-600/50 hover:bg-red-600 rounded text-xs",children:"Remove"}),e.jsx("button",{onClick:()=>{w(!1),N(null)},className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 rounded text-xs",children:"Close"})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:y?.configured?e.jsx("span",{className:"text-green-400",children:"âœ“ Webhook configured"}):e.jsx("span",{className:"text-gray-500",children:"No webhook configured"})}),e.jsx("button",{onClick:()=>w(!0),className:"text-xs text-cyan-400 hover:text-cyan-300",children:y?.configured?"Edit":"Setup"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Get notified in your Discord when you're attacked or receive peace proposals."})]})})}function $e({onUpload:a}){const[y,m]=t.useState(!1),[o,c]=t.useState([]),[i,n]=t.useState(!1),[p,s]=t.useState(""),[l,r]=t.useState(null),[x,N]=t.useState(null),v=t.useRef(null);t.useEffect(()=>{(async()=>{try{const h=await _.get("/api/warroom/media?limit=6");c(h.data)}catch(h){console.error("Failed to fetch media:",h)}})()},[]);const w=f=>{const h=f.target.files?.[0];if(h){if(h.size>5*1024*1024){N({type:"error",text:"File too large. Max 5MB."});return}r(h),N(null)}},C=async()=>{if(l){m(!0),N(null);try{const f=new FormData;f.append("file",l),p&&f.append("caption",p),await _.post("/api/warroom/media/upload",f,{headers:{"Content-Type":"multipart/form-data"}}),N({type:"success",text:"Image uploaded!"}),r(null),s(""),v.current&&(v.current.value="");const h=await _.get("/api/warroom/media?limit=6");c(h.data),a?.()}catch(f){N({type:"error",text:f.response?.data?.detail||"Upload failed"})}finally{m(!1)}}};return e.jsx(H,{title:"War Media",children:i?e.jsxs("div",{className:"space-y-3",children:[x&&e.jsx("div",{className:`text-xs p-2 rounded ${x.type==="success"?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:x.text}),e.jsx("input",{ref:v,type:"file",accept:"image/*",onChange:w,className:"w-full text-xs text-gray-400 file:mr-2 file:py-1 file:px-3 file:rounded file:border-0 file:text-xs file:bg-gray-700 file:text-gray-300 hover:file:bg-gray-600"}),l&&e.jsxs("div",{className:"text-xs text-green-400",children:["Selected: ",l.name]}),e.jsx("input",{type:"text",value:p,onChange:f=>s(f.target.value),placeholder:"Caption (optional)",className:"w-full bg-gray-800 border border-gray-600 rounded px-2 py-1.5 text-xs"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:C,disabled:y||!l,className:"flex-1 py-1.5 bg-purple-600 hover:bg-purple-500 disabled:bg-gray-600 rounded text-xs font-bold",children:y?"Uploading...":"Upload"}),e.jsx("button",{onClick:()=>{n(!1),N(null),r(null)},className:"px-3 py-1.5 bg-gray-700 hover:bg-gray-600 rounded text-xs",children:"Cancel"})]})]}):e.jsxs("div",{className:"space-y-3",children:[o.length>0?e.jsx("div",{className:"grid grid-cols-3 gap-1",children:o.slice(0,6).map(f=>e.jsx("div",{className:"aspect-square bg-gray-800 rounded overflow-hidden",title:f.caption||"War screenshot",children:e.jsx("img",{src:f.url,alt:f.caption||"War media",className:"w-full h-full object-cover",onError:h=>{h.target.style.display="none"}})},f.id))}):e.jsx("p",{className:"text-xs text-gray-500 text-center py-2",children:"No war media uploaded yet"}),e.jsx("button",{onClick:()=>n(!0),className:"w-full py-2 bg-purple-600/50 hover:bg-purple-600 border border-purple-500/30 rounded text-sm font-medium",children:"ðŸ“· Upload Screenshot"})]})})}function Le({partnerId:a,isSuperAdmin:y,onReleaseClaim:m,discordTag:o}){const[c,i]=t.useState([]),[n,p]=t.useState({systems:[],regions:{},total_systems:0}),[s,l]=t.useState(!0),[r,x]=t.useState("territory");t.useEffect(()=>{(a||y)&&(async()=>{try{const[w,C]=await Promise.all([_.get("/api/warroom/claims"),o?_.get(`/api/warroom/territory/by-tag?discord_tag=${encodeURIComponent(o)}`):Promise.resolve({data:{systems:[],regions:{}}})]),f=y?w.data:w.data.filter(h=>h.claimant_partner_id===a);i(f),p(C.data)}catch(w){console.error("Failed to fetch territory:",w)}finally{l(!1)}})()},[a,y,o]);const N=async v=>{if(confirm("Release this territorial claim?"))try{await _.delete(`/api/warroom/claims/${v}`),i(w=>w.filter(C=>C.id!==v)),m?.()}catch(w){console.error("Failed to release claim:",w)}};return s?e.jsx(H,{title:"My Territory",children:e.jsx("div",{className:"text-center py-4 text-gray-400",children:"Loading..."})}):e.jsxs(H,{title:y?"All Territory":"My Territory",children:[e.jsxs("div",{className:"flex gap-1 mb-3 bg-gray-800/50 rounded p-1",children:[e.jsxs("button",{onClick:()=>x("territory"),className:`flex-1 px-2 py-1 text-xs font-medium rounded ${r==="territory"?"bg-green-600 text-white":"text-gray-400 hover:text-white"}`,children:["Systems (",n.total_systems||0,")"]}),e.jsxs("button",{onClick:()=>x("claims"),className:`flex-1 px-2 py-1 text-xs font-medium rounded ${r==="claims"?"bg-cyan-600 text-white":"text-gray-400 hover:text-white"}`,children:["War Claims (",c.length,")"]})]}),r==="territory"?n.total_systems===0?e.jsx("div",{className:"text-center py-4 text-gray-500 text-sm",children:"No systems uploaded with your tag"}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:Object.entries(n.regions||{}).map(([v,w])=>e.jsxs("div",{className:"bg-gray-800/50 rounded p-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-medium text-green-400 text-sm",children:w.region_name||`Region (${w.region_x}, ${w.region_y}, ${w.region_z})`}),e.jsxs("span",{className:"text-xs text-gray-400",children:[w.system_count," systems"]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:w.galaxy})]},v))}):c.length===0?e.jsx("div",{className:"text-center py-4 text-gray-500 text-sm",children:"No war territory claims"}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:c.map(v=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-800/50 rounded p-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white text-sm",children:v.system_name||v.system_id}),e.jsxs("div",{className:"text-xs text-gray-400",children:[v.galaxy," â€¢ (",v.region_x,", ",v.region_y,", ",v.region_z,")"]}),y&&e.jsx("div",{className:"text-xs mt-1",style:{color:v.claimant_color},children:v.claimant_display_name})]}),e.jsx("button",{onClick:()=>N(v.id),className:"text-xs text-red-400 hover:text-red-300 px-2 py-1",children:"Release"})]},v.id))})]})}function ze({open:a,onClose:y,conflictId:m,onSuccess:o,isAttacker:c,myPartnerId:i}){const[n,p]=t.useState(null),[s,l]=t.useState([]),[r,x]=t.useState(!0),[N,v]=t.useState(!1),[w,C]=t.useState(null),[f,h]=t.useState([]),[R,T]=t.useState(""),[A,L]=t.useState(""),[F,j]=t.useState([]),[k,d]=t.useState(!1),[D,z]=t.useState(!1),[O,E]=t.useState(null),[u,M]=t.useState([]),[b,P]=t.useState([]),[G,Y]=t.useState("mine");t.useEffect(()=>{!a||!m||I()},[a,m]);const I=async()=>{x(!0);try{const[g,S,Q]=await Promise.all([_.get(`/api/warroom/conflicts/${m}/negotiation-status`),_.get(`/api/warroom/conflicts/${m}/peace-proposals`),_.get(`/api/warroom/conflicts/${m}`)]);p(g.data),l(S.data),E(Q.data);const te=c?Q.data.attacker_discord_tag:Q.data.defender_discord_tag,le=c?Q.data.defender_discord_tag:Q.data.attacker_discord_tag;if(te)try{const K=await _.get(`/api/warroom/territory/by-tag?discord_tag=${encodeURIComponent(te)}`);M(K.data.systems?.slice(0,50)||[])}catch{M([])}if(le)try{const K=await _.get(`/api/warroom/territory/by-tag?discord_tag=${encodeURIComponent(le)}`);P(K.data.systems?.slice(0,50)||[])}catch{P([])}}catch(g){console.error("Failed to fetch negotiation data:",g),C("Failed to load negotiation data")}finally{x(!1)}};t.useEffect(()=>{if(A.length<2){j([]);return}const g=setTimeout(async()=>{d(!0);try{const S=await _.get(`/api/warroom/territory/search?q=${encodeURIComponent(A)}&limit=20`);j(S.data)}catch(S){console.error("Search failed:",S)}finally{d(!1)}},300);return()=>clearTimeout(g)},[A]);const V=(g,S)=>{f.find(Q=>Q.id===g.id)||h([...f,{...g,direction:S||"give"}]),L(""),j([])},$=g=>{h(f.filter(S=>S.id!==g))},q=g=>{h(f.map(S=>S.id===g?{...S,direction:S.direction==="give"?"receive":"give"}:S))},J=async(g=!1)=>{if(f.length===0){C("Please select at least one system to include in the proposal");return}v(!0),C(null);try{await _.post(`/api/warroom/conflicts/${m}/propose-peace`,{items:f.map(S=>({type:"system",direction:S.direction,system_id:S.id,system_name:S.name||S.system_name,from_partner_id:S.direction==="give"?i:null,to_partner_id:S.direction==="receive"?i:null})),message:R,is_counter:g}),h([]),T(""),z(!1),I(),o?.()}catch(S){C(S.response?.data?.detail||"Failed to submit proposal")}finally{v(!1)}},ae=async g=>{if(confirm("Accept this peace treaty? This will end the war and transfer territory as specified.")){v(!0);try{await _.put(`/api/warroom/peace-proposals/${g}/accept`),o?.(),y()}catch(S){C(S.response?.data?.detail||"Failed to accept proposal")}finally{v(!1)}}},ee=async(g,S=!1)=>{if(confirm(S?"Walk away from negotiations? The war will continue.":"Reject this proposal? You may still send a counter-offer.")){v(!0);try{await _.put(`/api/warroom/peace-proposals/${g}/reject`,{walk_away:S}),I(),o?.()}catch(te){C(te.response?.data?.detail||"Failed to reject proposal")}finally{v(!1)}}};if(!a)return null;const W=s.find(g=>g.status==="pending"),X=W?.recipient_partner_id===i,Z=c?n?.attacker_counters_remaining:n?.defender_counters_remaining;return e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-900 border border-amber-500/30 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-amber-500/20",children:[e.jsx("h2",{className:"text-xl font-bold text-amber-500",children:"PEACE NEGOTIATIONS"}),e.jsx("button",{onClick:y,className:"text-gray-400 hover:text-white",children:"âœ•"})]}),r?e.jsx("div",{className:"p-8 text-center text-gray-400",children:"Loading negotiation status..."}):e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[w&&e.jsx("p",{className:"text-red-400 text-sm mb-4 p-2 bg-red-950/30 rounded",children:w}),e.jsxs("div",{className:"bg-gray-800/50 rounded p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-bold text-amber-400",children:"STATUS"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${n?.negotiation_status==="pending"?"bg-amber-500":n?.negotiation_status==="failed"?"bg-red-500":n?.negotiation_status==="accepted"?"bg-green-500":"bg-gray-500"} text-white`,children:n?.negotiation_status?.toUpperCase()||"NONE"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Your counter-offers remaining: "}),e.jsx("span",{className:`font-bold ${Z>0?"text-green-400":"text-red-400"}`,children:Z??2})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"War status: "}),e.jsx("span",{className:"font-bold text-white",children:n?.conflict_status?.toUpperCase()})]})]})]}),W&&X&&e.jsxs("div",{className:"bg-amber-950/30 border border-amber-500/30 rounded p-4 mb-4",children:[e.jsx("h3",{className:"text-sm font-bold text-amber-400 mb-3",children:"INCOMING PROPOSAL"}),e.jsxs("div",{className:"text-sm text-gray-300 mb-2",children:["From: ",e.jsx("span",{style:{color:W.proposer_color},className:"font-bold",children:W.proposer_name})]}),W.message&&e.jsxs("div",{className:"text-sm text-gray-400 italic mb-3",children:['"',W.message,'"']}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase",children:"Terms:"}),W.items.map((g,S)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm bg-gray-800/50 rounded p-2",children:[e.jsx("span",{className:g.direction==="give"?"text-red-400":"text-green-400",children:g.direction==="give"?"â†‘ GIVE":"â†“ RECEIVE"}),e.jsx("span",{className:"text-white",children:g.system_name||`Region (${g.region_x}, ${g.region_y}, ${g.region_z})`})]},S))]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>ae(W.id),disabled:N,className:"flex-1 py-2 bg-green-600 hover:bg-green-500 disabled:bg-gray-600 rounded font-bold text-sm",children:"Accept Treaty"}),e.jsx("button",{onClick:()=>ee(W.id,!1),disabled:N,className:"px-4 py-2 bg-amber-600 hover:bg-amber-500 disabled:bg-gray-600 rounded font-bold text-sm",children:"Counter"}),e.jsx("button",{onClick:()=>ee(W.id,!0),disabled:N,className:"px-4 py-2 bg-red-600 hover:bg-red-500 disabled:bg-gray-600 rounded font-bold text-sm",children:"Walk Away"})]})]}),W&&!X&&e.jsxs("div",{className:"bg-gray-800/50 border border-gray-500/30 rounded p-4 mb-4 text-center",children:[e.jsx("div",{className:"text-amber-400 text-lg mb-2",children:"Awaiting Response..."}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Your proposal was sent to ",e.jsx("span",{className:"font-bold text-white",children:W.recipient_name})]})]}),(!W||X&&Z>0)&&e.jsx(e.Fragment,{children:D?e.jsxs("div",{className:"bg-gray-800/50 rounded p-4 mb-4",children:[e.jsx("h3",{className:"text-sm font-bold text-amber-400 mb-3",children:W?"COUNTER-OFFER":"PEACE PROPOSAL"}),e.jsxs("div",{className:"bg-gray-900/50 border border-gray-600 rounded p-3 mb-4 text-xs text-gray-400",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-red-400 font-bold",children:"OFFER"})," = Systems you will give to the enemy"]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-green-400 font-bold",children:"DEMAND"})," = Systems you want from the enemy"]})]}),e.jsxs("div",{className:"flex gap-1 mb-3 bg-gray-800/50 rounded p-1",children:[e.jsxs("button",{onClick:()=>Y("mine"),className:`flex-1 px-2 py-1.5 text-xs font-medium rounded ${G==="mine"?"bg-red-600 text-white":"text-gray-400 hover:text-white"}`,children:["My Territory (",u.length,") - Offer"]}),e.jsxs("button",{onClick:()=>Y("enemy"),className:`flex-1 px-2 py-1.5 text-xs font-medium rounded ${G==="enemy"?"bg-green-600 text-white":"text-gray-400 hover:text-white"}`,children:["Enemy Territory (",b.length,") - Demand"]})]}),e.jsx("div",{className:"mb-4 max-h-32 overflow-y-auto bg-gray-800/30 rounded border border-gray-700",children:G==="mine"?u.length===0?e.jsx("p",{className:"text-gray-500 text-xs text-center py-4",children:"No territory to offer"}):e.jsx("div",{className:"divide-y divide-gray-700",children:u.map(g=>e.jsxs("button",{onClick:()=>V(g,"give"),disabled:f.some(S=>S.id===g.id),className:"w-full text-left px-3 py-2 hover:bg-red-900/30 disabled:opacity-50 disabled:cursor-not-allowed text-sm flex items-center justify-between",children:[e.jsx("span",{className:"text-white",children:g.name||g.system_name}),e.jsx("span",{className:"text-red-400 text-xs",children:"+ Offer"})]},g.id))}):b.length===0?e.jsx("p",{className:"text-gray-500 text-xs text-center py-4",children:"No enemy territory found"}):e.jsx("div",{className:"divide-y divide-gray-700",children:b.map(g=>e.jsxs("button",{onClick:()=>V(g,"receive"),disabled:f.some(S=>S.id===g.id),className:"w-full text-left px-3 py-2 hover:bg-green-900/30 disabled:opacity-50 disabled:cursor-not-allowed text-sm flex items-center justify-between",children:[e.jsx("span",{className:"text-white",children:g.name||g.system_name}),e.jsx("span",{className:"text-green-400 text-xs",children:"+ Demand"})]},g.id))})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"Or search any system:"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:A,onChange:g=>L(g.target.value),placeholder:"Search by system name...",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-1.5 text-xs"}),k&&e.jsx("span",{className:"absolute right-3 top-1.5 text-gray-400 text-xs",children:"..."}),F.length>0&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-gray-800 border border-gray-600 rounded shadow-lg max-h-32 overflow-y-auto",children:F.map(g=>e.jsxs("button",{onClick:()=>V(g,"give"),className:"w-full text-left px-3 py-2 hover:bg-gray-700 text-xs",children:[e.jsx("span",{className:"font-medium text-white",children:g.name||g.system_name}),g.discord_tag&&e.jsxs("span",{className:"text-gray-400 ml-2",children:["(",g.discord_tag,")"]})]},g.id))})]})]}),f.length>0&&e.jsxs("div",{className:"mb-4 bg-amber-950/30 border border-amber-500/30 rounded p-3",children:[e.jsxs("label",{className:"block text-sm text-amber-400 font-bold mb-2",children:["TREATY TERMS (",f.length," items)"]}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:f.map(g=>e.jsxs("div",{className:"flex items-center gap-2 bg-gray-800/50 rounded p-2",children:[e.jsx("button",{onClick:()=>q(g.id),className:`px-2 py-1 rounded text-xs font-bold ${g.direction==="give"?"bg-red-500/20 text-red-400":"bg-green-500/20 text-green-400"}`,children:g.direction==="give"?"â†‘ OFFER":"â†“ DEMAND"}),e.jsx("span",{className:"flex-1 text-sm text-white",children:g.name||g.system_name}),e.jsx("button",{onClick:()=>$(g.id),className:"text-red-400 hover:text-red-300 text-sm",children:"âœ•"})]},g.id))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Message (optional)"}),e.jsx("textarea",{value:R,onChange:g=>T(g.target.value),placeholder:"Diplomatic message...",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm",rows:2})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>J(!!W),disabled:N||f.length===0,className:"flex-1 py-2 bg-amber-600 hover:bg-amber-500 disabled:bg-gray-600 rounded font-bold",children:N?"Sending...":W?"Send Counter-Offer":"Send Proposal"}),e.jsx("button",{onClick:()=>{z(!1),h([]),T("")},className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded",children:"Cancel"})]})]}):e.jsx("button",{onClick:()=>z(!0),className:"w-full py-3 bg-amber-600 hover:bg-amber-500 rounded font-bold text-lg mb-4",children:W?"Send Counter-Offer":"Propose Peace Terms"})}),s.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-400 mb-2",children:"NEGOTIATION HISTORY"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:s.map(g=>e.jsxs("div",{className:`p-3 rounded border text-sm ${g.status==="accepted"?"bg-green-950/30 border-green-500/30":g.status==="rejected"?"bg-red-950/30 border-red-500/30":g.status==="pending"?"bg-amber-950/30 border-amber-500/30":"bg-gray-800/50 border-gray-500/30"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{style:{color:g.proposer_color},className:"font-bold",children:g.proposer_name}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${g.status==="accepted"?"bg-green-500":g.status==="rejected"?"bg-red-500":g.status==="pending"?"bg-amber-500":"bg-gray-500"} text-white`,children:g.status.toUpperCase()})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:[g.proposal_type==="counter"&&`Counter #${g.counter_number} â€¢ `,new Date(g.proposed_at).toLocaleString()]}),g.items.length>0&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[g.items.length," system(s) in terms"]})]},g.id))})]})]})]})})}function Me({open:a,onClose:y,conflictId:m,onUpdate:o,myPartnerId:c,enrolledCivs:i=[]}){const[n,p]=t.useState(null),[s,l]=t.useState([]),[r,x]=t.useState([]),[N,v]=t.useState(!0),[w,C]=t.useState("skirmish"),[f,h]=t.useState(""),[R,T]=t.useState(!1),[A,L]=t.useState(!1),[F,j]=t.useState(null),[k,d]=t.useState(!1),D=async()=>{v(!0);try{const[b,P,G]=await Promise.all([_.get("/api/warroom/conflicts/active"),_.get(`/api/warroom/conflicts/${m}/events`),_.get(`/api/warroom/conflicts/${m}/parties`)]),Y=b.data.find(I=>I.id===m);p(Y),l(P.data),x(G.data)}catch(b){console.error("Failed to fetch conflict details:",b)}finally{v(!1)}};t.useEffect(()=>{!a||!m||D()},[a,m]);const z=c&&r.some(b=>b.partner_id===c),O=r.find(b=>b.partner_id===c)?.side,E=async b=>{if(c){j(b);try{await _.post(`/api/warroom/conflicts/${m}/join`,{side:b}),await D(),o?.()}catch(P){console.error("Failed to join conflict:",P),alert(P.response?.data?.detail||"Failed to join conflict")}finally{j(null)}}},u=async()=>{if(!(!c||!O)){T(!0);try{const b=O==="attacker"?"defender":"attacker";await _.put(`/api/warroom/conflicts/${m}/resolve`,{resolution:"surrender",victor:b,notes:`${O==="attacker"?n.attacker_name:n.defender_name} surrendered`}),d(!1),o?.(),y()}catch(b){console.error("Failed to surrender:",b),alert(b.response?.data?.detail||"Failed to surrender")}finally{T(!1)}}},M=async()=>{if(f.trim()){T(!0);try{await _.post(`/api/warroom/conflicts/${m}/events`,{event_type:w,details:f});const b=await _.get(`/api/warroom/conflicts/${m}/events`);l(b.data),h(""),o?.()}catch(b){console.error("Failed to add event:",b)}finally{T(!1)}}};return a?e.jsxs("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:[e.jsxs("div",{className:"bg-gray-900 border border-red-500/30 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-red-500/20",children:[e.jsx("h2",{className:"text-xl font-bold text-red-500",children:"CONFLICT DETAILS"}),e.jsx("button",{onClick:y,className:"text-gray-400 hover:text-white",children:"âœ•"})]}),N?e.jsx("div",{className:"p-8 text-center text-gray-400",children:"Loading conflict details..."}):n?e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsxs("div",{className:"bg-gray-800/50 rounded p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${n.status==="active"?"bg-red-500 animate-pulse":n.status==="pending"?"bg-yellow-500":"bg-gray-500"} text-white`,children:n.status.toUpperCase()}),e.jsxs("span",{className:"text-xs text-gray-400",children:["ID: ",n.id]})]}),e.jsxs("div",{className:"text-lg font-bold text-white mb-2",children:["Battle for ",n.target_system_name]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{style:{color:n.attacker_color},className:"font-bold",children:n.attacker_name}),e.jsx("span",{className:"text-red-400",children:"âš”ï¸"}),e.jsx("span",{style:{color:n.defender_color},className:"font-bold",children:n.defender_name})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2",children:["Declared: ",new Date(n.declared_at).toLocaleString()]})]}),r.length>2&&e.jsxs("div",{className:"bg-gray-800/50 rounded p-4 mb-4",children:[e.jsx("h3",{className:"text-sm font-bold text-yellow-400 mb-2",children:"ALLIED PARTIES"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Attackers"}),r.filter(b=>b.side==="attacker").map(b=>e.jsxs("div",{className:"text-sm flex items-center gap-1",children:[e.jsx("span",{style:{color:b.color},children:b.display_name}),b.is_primary===1&&e.jsx("span",{className:"text-xs text-yellow-400",children:"(Lead)"})]},b.partner_id))]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Defenders"}),r.filter(b=>b.side==="defender").map(b=>e.jsxs("div",{className:"text-sm flex items-center gap-1",children:[e.jsx("span",{style:{color:b.color},children:b.display_name}),b.is_primary===1&&e.jsx("span",{className:"text-xs text-yellow-400",children:"(Lead)"})]},b.partner_id))]})]})]}),n.status!=="resolved"&&c&&!z&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-950/50 to-purple-950/50 border border-blue-500/30 rounded p-4 mb-4",children:[e.jsx("h3",{className:"text-sm font-bold text-blue-400 mb-3",children:"JOIN THIS CONFLICT"}),e.jsx("p",{className:"text-xs text-gray-400 mb-3",children:"Choose a side to join as an ally:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>E("attacker"),disabled:F,className:"py-3 px-4 bg-red-600/80 hover:bg-red-500 disabled:bg-gray-600 rounded border border-red-500/50 transition-all",children:[e.jsx("div",{className:"text-xs text-red-200 mb-1",children:"Join Attackers"}),e.jsx("div",{className:"font-bold",style:{color:n.attacker_color},children:F==="attacker"?"Joining...":`âš”ï¸ ${n.attacker_name}`})]}),e.jsxs("button",{onClick:()=>E("defender"),disabled:F,className:"py-3 px-4 bg-blue-600/80 hover:bg-blue-500 disabled:bg-gray-600 rounded border border-blue-500/50 transition-all",children:[e.jsx("div",{className:"text-xs text-blue-200 mb-1",children:"Join Defenders"}),e.jsx("div",{className:"font-bold",style:{color:n.defender_color},children:F==="defender"?"Joining...":`ðŸ›¡ï¸ ${n.defender_name}`})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-bold text-red-400 mb-2",children:"BATTLE TIMELINE"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:s.map((b,P)=>e.jsxs("div",{className:"flex gap-3 bg-gray-800/30 rounded p-2",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${b.event_type==="declared"?"bg-red-500":b.event_type==="acknowledged"?"bg-yellow-500":b.event_type==="resolved"?"bg-green-500":"bg-gray-500"}`}),P<s.length-1&&e.jsx("div",{className:"w-0.5 flex-1 bg-gray-700 mt-1"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-bold text-gray-300 uppercase",children:b.event_type}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(b.created_at).toLocaleString()})]}),e.jsx("div",{className:"text-sm text-gray-400",children:b.details}),b.actor_username&&e.jsxs("div",{className:"text-xs text-cyan-400",children:["by ",b.actor_username]})]})]},b.id))})]}),n.status!=="resolved"&&e.jsxs("div",{className:"bg-gray-800/50 rounded p-4",children:[e.jsx("h3",{className:"text-sm font-bold text-yellow-400 mb-2",children:"ADD BATTLE EVENT"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsxs("select",{value:w,onChange:b=>C(b.target.value),className:"bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm",children:[e.jsx("option",{value:"skirmish",children:"Skirmish"}),e.jsx("option",{value:"capture",children:"Capture"}),e.jsx("option",{value:"defense",children:"Defense"}),e.jsx("option",{value:"retreat",children:"Retreat"}),e.jsx("option",{value:"reinforcement",children:"Reinforcement"}),e.jsx("option",{value:"note",children:"Note"})]}),e.jsx("input",{type:"text",value:f,onChange:b=>h(b.target.value),placeholder:"Event details...",className:"flex-1 bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm"}),e.jsx("button",{onClick:M,disabled:R||!f.trim(),className:"px-3 py-1 bg-red-600 hover:bg-red-500 disabled:bg-gray-600 rounded text-sm font-bold",children:"Add"})]})]}),n.status==="active"&&c&&z&&e.jsx("div",{className:"mt-4 space-y-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{onClick:()=>L(!0),className:"py-3 bg-amber-600 hover:bg-amber-500 rounded font-bold",children:"ðŸ•Šï¸ Propose Peace"}),e.jsx("button",{onClick:()=>d(!0),className:"py-3 bg-gray-700 hover:bg-red-900 border border-red-500/30 rounded font-bold text-red-400",children:"ðŸ³ï¸ Surrender"})]})}),k&&e.jsxs("div",{className:"mt-4 bg-red-950/50 border border-red-500/50 rounded p-4",children:[e.jsx("h4",{className:"text-red-400 font-bold mb-2",children:"âš ï¸ Confirm Surrender"}),e.jsx("p",{className:"text-sm text-gray-300 mb-3",children:"Surrendering will immediately end this conflict in favor of your opponent. The enemy will be declared victorious and may claim the contested territory."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:u,disabled:R,className:"flex-1 py-2 bg-red-600 hover:bg-red-500 disabled:bg-gray-600 rounded font-bold",children:R?"Surrendering...":"Confirm Surrender"}),e.jsx("button",{onClick:()=>d(!1),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded",children:"Cancel"})]})]})]}):e.jsx("div",{className:"p-8 text-center text-gray-400",children:"Conflict not found"})]}),e.jsx(ze,{open:A,onClose:()=>L(!1),conflictId:m,onSuccess:()=>{o?.(),L(!1)},isAttacker:n?.attacker_partner_id===c,myPartnerId:c})]}):null}function Fe({isCorrespondent:a,isSuperAdmin:y,onCreateNews:m}){const[o,c]=t.useState([]),[i,n]=t.useState(!0),[p,s]=t.useState(null);t.useEffect(()=>{(async()=>{try{const x=await _.get("/api/warroom/news?limit=50");c(x.data)}catch(x){console.error("Failed to fetch news:",x)}finally{n(!1)}})()},[]);const l=r=>({breaking:"ðŸ”´",report:"ðŸ“‹",analysis:"ðŸ“Š",editorial:"âœï¸",announcement:"ðŸ“¢"})[r]||"ðŸ“°";return i?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"Loading news..."}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:o.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No news articles yet"}):o.map(r=>e.jsx("div",{onClick:()=>s(r),className:"bg-gray-800/50 border border-yellow-500/20 rounded p-4 cursor-pointer hover:border-yellow-500/50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl",children:l(r.article_type)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.is_pinned===1&&e.jsx("span",{className:"text-xs bg-yellow-500/20 text-yellow-400 px-1.5 py-0.5 rounded",children:"PINNED"}),e.jsx("span",{className:"text-xs text-gray-500 uppercase",children:r.article_type||"news"})]}),e.jsx("h3",{className:"font-bold text-white",children:r.headline}),e.jsx("p",{className:"text-sm text-gray-400 mt-1 line-clamp-2",children:r.body}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-gray-500",children:[e.jsxs("span",{children:["By ",r.author_name||"Unknown"]}),r.reporting_org_name&&e.jsx("span",{className:"text-cyan-400",children:r.reporting_org_name}),e.jsx("span",{children:new Date(r.created_at).toLocaleDateString()}),r.view_count>0&&e.jsxs("span",{children:["ðŸ‘ ",r.view_count]})]})]})]})},r.id))}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-900 border border-yellow-500/30 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-yellow-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:l(p.article_type)}),e.jsx("span",{className:"text-xs text-gray-400 uppercase",children:p.article_type||"news"})]}),e.jsx("button",{onClick:()=>s(null),className:"text-gray-400 hover:text-white",children:"âœ•"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-white mb-4",children:p.headline}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-400 mb-6",children:[e.jsxs("span",{children:["By ",p.author_name||"Unknown"]}),p.reporting_org_name&&e.jsxs("span",{className:"text-cyan-400",children:["â€¢ ",p.reporting_org_name]}),e.jsxs("span",{children:["â€¢ ",new Date(p.created_at).toLocaleString()]})]}),e.jsx("div",{className:"prose prose-invert max-w-none",children:e.jsx("p",{className:"text-gray-300 whitespace-pre-wrap",children:p.body})})]})]})})]})}function Pe({open:a,onClose:y,onSuccess:m,activeConflicts:o=[]}){const[c,i]=t.useState(""),[n,p]=t.useState(""),[s,l]=t.useState("breaking"),[r,x]=t.useState(""),[N,v]=t.useState(!1),[w,C]=t.useState(null);if(!a)return null;const f=async()=>{if(!c||!n){C("Headline and body are required");return}v(!0),C(null);try{const h={headline:c,body:n,article_type:s};r&&(h.conflict_id=parseInt(r)),await _.post("/api/warroom/news",h),m(),y(),i(""),p(""),l("breaking"),x("")}catch(h){C(h.response?.data?.detail||"Failed to create news")}finally{v(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-900 border border-yellow-500/30 rounded-lg p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold text-yellow-500 mb-4",children:"ðŸ“° CREATE WAR NEWS"}),w&&e.jsx("p",{className:"text-red-400 text-sm mb-4 p-2 bg-red-950/30 rounded",children:w}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Article Type"}),e.jsxs("select",{value:s,onChange:h=>l(h.target.value),className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-sm",children:[e.jsx("option",{value:"breaking",children:"ðŸ”´ Breaking News"}),e.jsx("option",{value:"report",children:"ðŸ“‹ Battle Report"}),e.jsx("option",{value:"analysis",children:"ðŸ“Š Analysis"}),e.jsx("option",{value:"editorial",children:"âœï¸ Editorial"}),e.jsx("option",{value:"announcement",children:"ðŸ“¢ Announcement"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Link to Conflict"}),e.jsxs("select",{value:r,onChange:h=>x(h.target.value),className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-sm",children:[e.jsx("option",{value:"",children:"No linked conflict"}),o.map(h=>e.jsxs("option",{value:h.id,children:[h.target_system_name," (",h.attacker_name," vs ",h.defender_name,")"]},h.id))]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Headline"}),e.jsx("input",{type:"text",value:c,onChange:h=>i(h.target.value),placeholder:"Breaking news headline...",className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-sm"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"Article Body"}),e.jsx("textarea",{value:n,onChange:h=>p(h.target.value),placeholder:"Full article content...",className:"w-full bg-gray-800 border border-gray-600 rounded px-3 py-2 text-sm",rows:8})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:f,disabled:N,className:"flex-1 py-2 bg-yellow-600 hover:bg-yellow-500 disabled:bg-gray-600 rounded font-bold text-black",children:N?"Publishing...":"PUBLISH NEWS"}),e.jsx("button",{onClick:y,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded",children:"Cancel"})]})]})})}function He(){const a=t.useContext(ue),[y,m]=t.useState(!0),[o,c]=t.useState(null),[i,n]=t.useState([]),[p,s]=t.useState({objectives:[]}),[l,r]=t.useState({}),[x,N]=t.useState([]),[v,w]=t.useState([]),[C,f]=t.useState(0),[h,R]=t.useState(null),[T,A]=t.useState([]),[L,F]=t.useState("command"),[j,k]=t.useState(!1),[d,D]=t.useState(!1),[z,O]=t.useState(!1),[E,u]=t.useState(!1),[M,b]=t.useState(null),[P,G]=t.useState(null),Y=$=>{if(!o?.enrolled&&!a.isSuperAdmin)return;const q=T.find(J=>J.system_id===$.id);q&&(q.claimant_partner_id===o?.partner_id&&!a.isSuperAdmin||(G($),k(!0)))},I=async()=>{try{const[$,q,J,ae,ee,W,X,Z]=await Promise.all([_.get("/api/warroom/enrollment/status"),_.get("/api/warroom/conflicts/active"),_.get("/api/warroom/debrief"),_.get("/api/warroom/statistics"),_.get("/api/warroom/statistics/leaderboard"),_.get("/api/warroom/news/ticker"),_.get("/api/warroom/notifications/count"),_.get("/api/warroom/claims")]);c($.data),n(q.data),s(J.data),r(ae.data),N(ee.data),w(W.data),f(X.data.count),A(Z.data)}catch($){console.error("Failed to fetch War Room data:",$),R($.response?.data?.detail||"Failed to load War Room data")}finally{m(!1)}};t.useEffect(()=>{I();const $=setInterval(I,3e4);return()=>clearInterval($)},[]);const V=async $=>{await _.put("/api/warroom/debrief",{objectives:$}),s(q=>({...q,objectives:$}))};return y?e.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"#0a0c10"},children:e.jsx("div",{className:"text-red-400 text-xl animate-pulse",children:"Loading War Room..."})}):h?e.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"#0a0c10"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-xl mb-4",children:"Access Denied"}),e.jsx("p",{className:"text-gray-400",children:h}),e.jsx(ie,{to:"/",className:"text-red-400 hover:underline mt-4 inline-block",children:"Return to Dashboard"})]})}):e.jsxs("div",{className:"min-h-screen -m-6 -mb-6",style:{backgroundColor:"#0a0c10"},children:[e.jsx("style",{children:`
        @keyframes marquee {
          0% { transform: translateX(0); }
          100% { transform: translateX(-50%); }
        }
        .animate-marquee {
          animation: marquee 30s linear infinite;
        }
        .war-grid {
          background-image:
            linear-gradient(rgba(239, 68, 68, 0.05) 1px, transparent 1px),
            linear-gradient(90deg, rgba(239, 68, 68, 0.05) 1px, transparent 1px);
          background-size: 50px 50px;
        }
      `}),e.jsx("div",{className:"border-b border-red-500/30 bg-gray-900/90 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-500 tracking-wider",children:"WAR ROOM"}),a.isCorrespondent&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-yellow-500/20 border border-yellow-500/30 rounded",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-yellow-500 animate-pulse"}),e.jsx("span",{className:"text-xs text-yellow-400 font-medium",children:"WAR CORRESPONDENT"})]}),o?.enrolled&&!a.isCorrespondent&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-green-500/20 border border-green-500/30 rounded",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),e.jsx("span",{className:"text-xs text-green-400 font-medium",children:o.display_name||"ENROLLED"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-gray-800/50 rounded p-1 ml-4",children:[e.jsx("button",{onClick:()=>F("command"),className:`px-3 py-1 text-sm font-medium rounded transition-colors ${L==="command"?"bg-red-600 text-white":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:"Command Center"}),e.jsx("button",{onClick:()=>F("news"),className:`px-3 py-1 text-sm font-medium rounded transition-colors ${L==="news"?"bg-yellow-600 text-black":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:"News Room"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o?.enrolled&&!o?.is_super_admin&&!a.isCorrespondent&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>k(!0),className:"px-4 py-2 bg-red-600 hover:bg-red-500 rounded text-sm font-bold border-2 border-red-400 shadow-lg shadow-red-500/20 animate-pulse",children:"âš”ï¸ DECLARE WAR"}),e.jsx("button",{onClick:()=>D(!0),className:"px-3 py-1 bg-green-600 hover:bg-green-500 rounded text-sm font-bold",children:"Claim Territory"}),e.jsx("button",{onClick:()=>O(!0),className:"px-3 py-1 bg-yellow-600 hover:bg-yellow-500 rounded text-sm font-bold text-black",children:"+ News"}),e.jsx("button",{onClick:()=>u(!0),className:"px-3 py-1 bg-cyan-600 hover:bg-cyan-500 rounded text-sm",title:"Set your civilization's home region",children:"HQ"})]}),a.isCorrespondent&&e.jsx("button",{onClick:()=>O(!0),className:"px-3 py-1 bg-yellow-600 hover:bg-yellow-500 rounded text-sm font-bold text-black",children:"+ News"}),a.isSuperAdmin&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>k(!0),className:"px-4 py-2 bg-red-600 hover:bg-red-500 rounded text-sm font-bold border-2 border-red-400 shadow-lg shadow-red-500/20",children:"âš”ï¸ WAR"}),e.jsx("button",{onClick:()=>O(!0),className:"px-3 py-1 bg-yellow-600 hover:bg-yellow-500 rounded text-sm font-bold text-black",children:"+ News"}),e.jsx("button",{onClick:()=>D(!0),className:"px-3 py-1 bg-green-600 hover:bg-green-500 rounded text-sm font-bold",children:"Claim"})]}),e.jsx(De,{count:C,onRead:()=>f(0)}),a.isSuperAdmin&&e.jsx(ie,{to:"/war-room/admin",className:"px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-sm ml-2",children:"Admin"})]})]})}),e.jsx(_e,{news:v}),L==="command"?e.jsx("div",{className:"p-6 war-grid",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx(H,{title:"Galactic War Map",className:"h-[550px]",children:e.jsx(Ne,{className:"h-full rounded",onSystemSelect:Y})}),e.jsx("div",{className:"mt-6",children:e.jsx(H,{title:`Active Conflicts (${i.length})`,children:i.length===0?e.jsx("p",{className:"text-gray-500 text-sm text-center py-4",children:"No active conflicts. The galaxy is at peace... for now."}):e.jsx("div",{className:"max-h-64 overflow-y-auto pr-2",children:i.map($=>e.jsx("div",{onClick:()=>b($.id),className:"cursor-pointer hover:ring-1 hover:ring-red-500/50 rounded transition-all",children:e.jsx(we,{conflict:$})},$.id))})})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ce,{debrief:p,onUpdate:V,canEdit:a.isSuperAdmin}),e.jsx(ce,{maxItems:10,onConflictClick:b}),(o?.enrolled||a.isSuperAdmin)&&e.jsx(Le,{partnerId:o?.partner_id,isSuperAdmin:a.isSuperAdmin,onReleaseClaim:I,discordTag:o?.discord_tag}),o?.enrolled&&!a.isSuperAdmin&&e.jsx(Te,{isEnrolled:o?.enrolled}),(o?.enrolled||a.isSuperAdmin||a.isCorrespondent)&&e.jsx($e,{onUpload:I}),e.jsx(ke,{stats:l}),e.jsx(Se,{leaderboard:x,activeConflicts:i})]})]})}):e.jsx("div",{className:"p-6 war-grid",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsx(H,{title:"War News & Reports",className:"min-h-[600px]",children:e.jsx(Fe,{isCorrespondent:a.isCorrespondent,isSuperAdmin:a.isSuperAdmin,onCreateNews:()=>O(!0)})})}),e.jsxs("div",{className:"space-y-6",children:[(a.isCorrespondent||a.isSuperAdmin)&&e.jsx(H,{title:"Reporter Actions",children:e.jsx("div",{className:"space-y-2",children:e.jsx("button",{onClick:()=>O(!0),className:"w-full py-2 bg-yellow-600 hover:bg-yellow-500 rounded font-bold text-black text-sm",children:"Write Article"})})}),e.jsx(ce,{maxItems:8}),e.jsx(H,{title:"Active Conflicts",children:i.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No active conflicts"}):e.jsx("div",{className:"space-y-2",children:i.slice(0,5).map($=>e.jsxs("div",{onClick:()=>{b($.id),F("command")},className:"cursor-pointer p-2 bg-gray-800/50 rounded hover:bg-gray-800 text-sm",children:[e.jsx("div",{className:"font-medium text-white",children:$.target_system_name}),e.jsxs("div",{className:"text-xs text-gray-400",children:[e.jsx("span",{style:{color:$.attacker_color},children:$.attacker_name})," vs ",e.jsx("span",{style:{color:$.defender_color},children:$.defender_name})]})]},$.id))})})]})]})}),e.jsx(Re,{open:j,onClose:()=>k(!1),onSuccess:I,claims:T,isSuperAdmin:a.isSuperAdmin,enrolledCivs:x,myPartnerId:o?.partner_id,preSelectedSystem:P,onClearPreSelected:()=>G(null)}),e.jsx(Ee,{open:d,onClose:()=>D(!1),onSuccess:I,isSuperAdmin:a.isSuperAdmin,enrolledCivs:x}),e.jsx(Pe,{open:z,onClose:()=>O(!1),onSuccess:I,activeConflicts:i}),e.jsx(Me,{open:!!M,onClose:()=>b(null),conflictId:M,onUpdate:I,myPartnerId:o?.partner_id,enrolledCivs:x}),e.jsx(Ae,{open:E,onClose:()=>u(!1),onSuccess:I,partnerId:o?.partner_id})]})}export{He as default};
