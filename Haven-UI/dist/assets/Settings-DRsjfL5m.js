import{j as e}from"./vendor-three-B8lJlG1P.js";import{b as t}from"./vendor-react-D7IcbEIw.js";import{A as re}from"./index-DfzvULyl.js";import{c as ne}from"./usePersonalColor--X9CeE-n.js";import{C as n}from"./Card-C4YgI0Ez.js";import{B as l}from"./Button-CI6OWZ-Z.js";import"./vendor-ui-B9ygI19o.js";function ue(){const Y=t.useContext(re),{isAdmin:z,isSuperAdmin:h,isPartner:i,user:u,logout:N}=Y||{},[r,T]=t.useState({}),[c,k]=t.useState({}),[g,v]=t.useState("#00C2B3"),[x,C]=t.useState("#c026d3"),[I,Z]=t.useState(!0),[p,y]=t.useState(!1),[E,U]=t.useState(!1),[B,_]=t.useState(!1),[b,O]=t.useState(""),[d,F]=t.useState(""),[P,R]=t.useState(""),[D,A]=t.useState(!1),[M,H]=t.useState(!1),[o,J]=t.useState(""),[f,L]=t.useState(""),[$,G]=t.useState(!1);t.useEffect(()=>{fetch("/api/settings",{credentials:"include"}).then(s=>s.json()).then(s=>{T(s||{}),s&&s.personal_color&&C(s.personal_color)}).catch(()=>{}).finally(()=>Z(!1)),i&&(fetch("/api/partner/theme",{credentials:"include"}).then(s=>s.json()).then(s=>k(s.theme||{})).catch(()=>{}),fetch("/api/partner/region_color",{credentials:"include"}).then(s=>s.json()).then(s=>v(s.color||"#00C2B3")).catch(()=>{}))},[i]);const w=(s,a)=>{const m={...r.theme||{},[s]:a};T({...r,theme:m}),s==="bg"&&document.documentElement.style.setProperty("--app-bg",a),s==="text"&&document.documentElement.style.setProperty("--app-text",a),s==="card"&&document.documentElement.style.setProperty("--app-card",a),s==="primary"&&document.documentElement.style.setProperty("--app-primary",a)},j=(s,a)=>{const m={...c,[s]:a};k(m),s==="bg"&&document.documentElement.style.setProperty("--app-bg",a),s==="text"&&document.documentElement.style.setProperty("--app-text",a),s==="card"&&document.documentElement.style.setProperty("--app-card",a),s==="primary"&&document.documentElement.style.setProperty("--app-primary",a)},q=async()=>{y(!0);try{const s=await fetch("/api/settings",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!s.ok)throw new Error(await s.text());alert("Settings saved successfully!")}catch(s){alert("Failed to save settings: "+s)}y(!1)},K=async()=>{y(!0);try{const s=await fetch("/api/partner/theme",{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({theme:c})});if(!s.ok)throw new Error(await s.text());alert("Theme saved successfully!")}catch(s){alert("Failed to save theme: "+s)}y(!1)},Q=async()=>{U(!0);try{const s=await fetch("/api/partner/region_color",{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({color:g})});if(!s.ok){const a=await s.json();throw new Error(a.detail||"Failed to save")}alert("Region color saved! The 3D map will now show your regions in this color.")}catch(s){alert("Failed to save region color: "+s.message)}U(!1)},V=async()=>{_(!0);try{const s=await fetch("/api/settings",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({personal_color:x})});if(!s.ok)throw new Error(await s.text());ne(),alert("Personal submission color saved!")}catch(s){alert("Failed to save personal color: "+s)}_(!1)},W=async()=>{try{const s=await fetch("/api/backup",{method:"POST",credentials:"include"});if(!s.ok)throw new Error(await s.text());const a=await s.json();alert("Backup created: "+a.backup_path)}catch(s){alert("Backup failed: "+s)}},X=async s=>{try{const a=s.target.files&&s.target.files[0];if(!a)return;const m=new FormData;m.append("file",a);const S=await fetch("/api/db_upload",{method:"POST",credentials:"include",body:m});if(!S.ok)throw new Error(await S.text());const te=await S.json();alert("DB uploaded: "+te.path)}catch(a){alert("DB upload failed: "+a)}},ee=async()=>{if(confirm('This will rename systems that have "HUB Tag:" in their description to use the hub tag as the system name. The original name will be preserved in the notes. Continue?')){H(!0);try{const s=await fetch("/api/migrate_hub_tags",{method:"POST",credentials:"include"});if(!s.ok)throw new Error(await s.text());const a=await s.json();alert(`Migration complete!

Updated: ${a.updated} systems
Total found with HUB Tag: ${a.total_found}`)}catch(s){alert("Migration failed: "+s)}finally{H(!1)}}},se=async()=>{if(!b){alert("Please enter your current password");return}if(!d||d.length<4){alert("New password must be at least 4 characters");return}if(d!==P){alert("New passwords do not match");return}A(!0);try{const s=await fetch("/api/change_password",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({current_password:b,new_password:d})});if(!s.ok){const a=await s.json();throw new Error(a.detail||"Failed to change password")}alert("Password changed successfully! Please log in again with your new password."),O(""),F(""),R(""),N()}catch(s){alert("Failed to change password: "+s.message)}finally{A(!1)}},ae=async()=>{if(!f){alert("Please enter your current password");return}if(!o||o.length<3){alert("New username must be at least 3 characters");return}if(o.length>50){alert("Username must be 50 characters or less");return}if(!/^[a-zA-Z0-9_-]+$/.test(o)){alert("Username can only contain letters, numbers, underscores, and hyphens");return}G(!0);try{const s=await fetch("/api/change_username",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({current_password:f,new_username:o})});if(!s.ok){const a=await s.json();throw new Error(a.detail||"Failed to change username")}alert("Username changed successfully! Please log in again with your new username."),J(""),L(""),N()}catch(s){alert("Failed to change username: "+s.message)}finally{G(!1)}};return I?e.jsx("div",{className:"flex items-center justify-center min-h-64",children:e.jsx("div",{className:"text-lg text-gray-400",children:"Loading settings..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-cyan-400",children:"Settings"}),e.jsx(n,{className:"bg-gray-800/50",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Logged in as"}),e.jsxs("div",{className:"text-gray-300",children:[e.jsx("p",{children:e.jsx("strong",{children:u?.displayName||u?.username})}),h&&e.jsx("p",{className:"text-yellow-400 text-sm",children:"Super Admin"}),i&&u?.discordTag&&e.jsxs("p",{className:"text-cyan-400 text-sm",children:["Partner: ",u.discordTag]})]}),e.jsx(l,{className:"mt-3",variant:"danger",onClick:N,children:"Logout"})]})}),z&&e.jsx(n,{className:"bg-gray-800/50",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Change Password"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Update your password. You will be logged out after changing your password."}),e.jsxs("div",{className:"space-y-4 max-w-md",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Current Password"}),e.jsx("input",{type:"password",value:b,onChange:s=>O(s.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",placeholder:"Enter current password"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"New Password"}),e.jsx("input",{type:"password",value:d,onChange:s=>F(s.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",placeholder:"Enter new password (min 4 characters)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Confirm New Password"}),e.jsx("input",{type:"password",value:P,onChange:s=>R(s.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",placeholder:"Confirm new password"})]}),e.jsx(l,{onClick:se,disabled:D||!b||!d||!P,children:D?"Changing...":"Change Password"})]})]})}),i&&e.jsx(n,{className:"bg-gray-800/50",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Change Username"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Update your login username. You will be logged out after changing your username."}),e.jsxs("div",{className:"space-y-4 max-w-md",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Current Username"}),e.jsx("p",{className:"text-white font-medium",children:u?.username||""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"New Username"}),e.jsx("input",{type:"text",value:o,onChange:s=>J(s.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",placeholder:"Enter new username (min 3 characters)"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Letters, numbers, underscores, and hyphens only"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Current Password"}),e.jsx("input",{type:"password",value:f,onChange:s=>L(s.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",placeholder:"Enter your password to confirm"})]}),e.jsx(l,{onClick:ae,disabled:$||!o||!f,children:$?"Changing...":"Change Username"})]})]})}),i&&e.jsx(n,{className:"bg-gray-800/50",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Your Theme"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Customize your view of Haven Control Room. These settings only affect your session."}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Background"}),e.jsx("input",{type:"color",value:c.bg||"#1f2937",onChange:s=>j("bg",s.target.value),className:"w-full h-10 rounded cursor-pointer"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Text"}),e.jsx("input",{type:"color",value:c.text||"#f3f4f6",onChange:s=>j("text",s.target.value),className:"w-full h-10 rounded cursor-pointer"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Card"}),e.jsx("input",{type:"color",value:c.card||"#374151",onChange:s=>j("card",s.target.value),className:"w-full h-10 rounded cursor-pointer"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Primary"}),e.jsx("input",{type:"color",value:c.primary||"#06b6d4",onChange:s=>j("primary",s.target.value),className:"w-full h-10 rounded cursor-pointer"})]})]}),e.jsx(l,{className:"mt-4",onClick:K,disabled:p,children:p?"Saving...":"Save Your Theme"})]})}),i&&e.jsx(n,{className:"bg-gray-800/50",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"3D Galaxy Map - Region Color"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Choose a custom color for your community's regions on the 3D galaxy map. This color will be visible to everyone viewing the map."}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Region Point Color"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"color",value:g,onChange:s=>v(s.target.value),className:"w-16 h-10 rounded cursor-pointer border-2 border-gray-600"}),e.jsx("input",{type:"text",value:g,onChange:s=>{const a=s.target.value;/^#[0-9A-Fa-f]{0,6}$/.test(a)&&v(a)},placeholder:"#00C2B3",className:"w-28 px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white font-mono text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Preview"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full shadow-lg",style:{backgroundColor:g,boxShadow:`0 0 15px ${g}80`}}),e.jsx("span",{className:"text-sm text-gray-400",children:"This is how your regions will appear on the map"})]})]})]}),e.jsx(l,{className:"mt-4",onClick:Q,disabled:E,children:E?"Saving...":"Save Region Color"})]})}),h&&e.jsx(n,{className:"bg-gray-800/50",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Global Theme"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Server-side theme controls the color palette for all users (default)."}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Background"}),e.jsx("input",{type:"color",value:r.theme&&r.theme.bg||"#1f2937",onChange:s=>w("bg",s.target.value),className:"w-full h-10 rounded cursor-pointer"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Text"}),e.jsx("input",{type:"color",value:r.theme&&r.theme.text||"#f3f4f6",onChange:s=>w("text",s.target.value),className:"w-full h-10 rounded cursor-pointer"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Card"}),e.jsx("input",{type:"color",value:r.theme&&r.theme.card||"#374151",onChange:s=>w("card",s.target.value),className:"w-full h-10 rounded cursor-pointer"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Primary"}),e.jsx("input",{type:"color",value:r.theme&&r.theme.primary||"#06b6d4",onChange:s=>w("primary",s.target.value),className:"w-full h-10 rounded cursor-pointer"})]})]}),e.jsx(l,{className:"mt-4",onClick:q,disabled:p,children:p?"Saving...":"Save Global Theme"})]})}),h&&e.jsx(n,{className:"bg-gray-800/50",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Personal Submission Badge Color"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Customize the color used for personal submissions (submissions without a community tag). This color is visible across the UI where personal badges are displayed."}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Badge Color"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"color",value:x,onChange:s=>C(s.target.value),className:"w-16 h-10 rounded cursor-pointer border-2 border-gray-600"}),e.jsx("input",{type:"text",value:x,onChange:s=>{const a=s.target.value;/^#[0-9A-Fa-f]{0,6}$/.test(a)&&C(a)},placeholder:"#c026d3",className:"w-28 px-3 py-2 bg-gray-700 border border-gray-600 rounded text-white font-mono text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500"})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Preview"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-1 rounded text-xs font-semibold text-white",style:{backgroundColor:x},children:"PERSONAL"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Badge preview"})]})]})]}),e.jsx(l,{className:"mt-4",onClick:V,disabled:B,children:B?"Saving...":"Save Personal Color"})]})}),h&&e.jsx(n,{className:"bg-gray-800/50",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Database Management"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Create backups or restore the database from a backup file."}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{children:e.jsx(l,{onClick:W,children:"Create Backup"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-300 mb-1",children:"Upload Database (.db file)"}),e.jsx("input",{type:"file",accept:".db",onChange:X,className:"text-sm text-gray-400"})]})]})]})}),h&&e.jsx(n,{className:"bg-gray-800/50",children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"Data Migration"}),e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"One-time migration tools for updating system data."}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-2",children:"Hub Tag Migration"}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:'Renames systems that have "HUB Tag:" in their description to use the hub tag as the display name. The original system name will be preserved in the notes as "New Name:".'}),e.jsx(l,{onClick:ee,disabled:M,children:M?"Migrating...":"Migrate Hub Tags to Names"})]})})]})})]})}export{ue as default};
