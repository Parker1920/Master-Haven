import{j as e}from"./vendor-three-B8lJlG1P.js";import{u as z,b as r}from"./vendor-react-D7IcbEIw.js";import{a as p}from"./vendor-ui-B9ygI19o.js";import{L as O}from"./LeaderboardTable-DqzZUvMi.js";import{A as U}from"./index-DfzvULyl.js";import{f as Y,p as H}from"./parseISO-9NS-6p47.js";const f={submissions:{label:"System Submissions",icon:"ðŸŒŒ",color:"bg-cyan-500"},discoveries:{label:"Discoveries",icon:"ðŸ”¬",color:"bg-purple-500"},both:{label:"Systems + Discoveries",icon:"ðŸ†",color:"bg-amber-500"}};function ae(){const i=z(),x=r.useContext(U),{isSuperAdmin:a,isAdmin:u,isPartner:v,user:K}=x,[D,L]=r.useState(!0),[k,h]=r.useState([]),[T,A]=r.useState([]),[F,b]=r.useState(!1),[M,N]=r.useState(!1),[n,$]=r.useState(null),[o,B]=r.useState({leaderboard:[],totals:{}}),[w,_]=r.useState(!1),[d,q]=r.useState("submissions"),[l,m]=r.useState({name:"",discord_tag:"",start_date:"",end_date:"",description:"",event_type:"submissions"});r.useEffect(()=>{!x.loading&&!u&&!v&&i("/")},[x.loading,u,v,i]),r.useEffect(()=>{a&&(async()=>{try{const t=await p.get("/api/discord_tags");A(t.data.tags||[])}catch(t){console.error("Failed to fetch discord tags:",t)}})()},[a]),r.useEffect(()=>{if(!u&&!v)return;(async()=>{try{const t=await p.get("/api/events",{params:{include_inactive:!0},withCredentials:!0});h(t.data.events||[])}catch(t){console.error("Failed to fetch events:",t)}finally{L(!1)}})()},[u,v]);const I=async s=>{s.preventDefault();try{if((await p.post("/api/events",l,{withCredentials:!0})).data.success){const c=await p.get("/api/events",{params:{include_inactive:!0},withCredentials:!0});h(c.data.events||[]),b(!1),m({name:"",discord_tag:"",start_date:"",end_date:"",description:"",event_type:"submissions"})}}catch(t){console.error("Failed to create event:",t),alert(t.response?.data?.detail||"Failed to create event")}},C=async(s,t=null)=>{const c=s.event_type||"submissions",S=t||(c==="discoveries"?"discoveries":c==="both"?"combined":"submissions");$(s),q(S),N(!0),_(!0);try{const j=await p.get(`/api/events/${s.id}/leaderboard`,{params:{tab:S},withCredentials:!0});B({leaderboard:j.data.leaderboard||[],totals:j.data.totals||{}})}catch(j){console.error("Failed to fetch event leaderboard:",j)}finally{_(!1)}},P=s=>{n&&C(n,s)},R=async s=>{try{await p.put(`/api/events/${s.id}`,{is_active:s.is_active?0:1},{withCredentials:!0});const t=await p.get("/api/events",{params:{include_inactive:!0},withCredentials:!0});h(t.data.events||[])}catch(t){console.error("Failed to toggle event:",t)}},V=async s=>{if(window.confirm(`Are you sure you want to delete "${s.name}"?`))try{await p.delete(`/api/events/${s.id}`,{withCredentials:!0});const t=await p.get("/api/events",{params:{include_inactive:!0},withCredentials:!0});h(t.data.events||[])}catch(t){console.error("Failed to delete event:",t)}},y=s=>{try{return Y(H(s),"MMM d, yyyy")}catch{return s}},W=s=>{const t=new Date().toISOString();return s.is_active?s.start_date>t?{label:"Upcoming",color:"bg-blue-500"}:s.end_date+"T23:59:59"<t?{label:"Ended",color:"bg-gray-500"}:{label:"Active",color:"bg-green-500"}:{label:"Inactive",color:"bg-gray-500"}},E=s=>{const t=s?.event_type||"submissions";return t==="submissions"?["submissions"]:t==="discoveries"?["discoveries"]:["combined","submissions","discoveries"]};return x.loading||D?e.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{background:"var(--app-bg)"},children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2",style:{borderColor:"var(--app-primary)"}})}):!u&&!v?null:e.jsxs("div",{className:"min-h-screen p-6",style:{background:"var(--app-bg)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",style:{color:"var(--app-text)"},children:"Community Events"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--app-text)",opacity:.6},children:"Track submissions and discoveries during event periods"})]}),e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors",style:{background:"var(--app-primary)",color:"#000"},children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"New Event"]})]}),k.length===0?e.jsxs("div",{className:"rounded-xl p-12 text-center",style:{background:"linear-gradient(180deg, rgba(255,255,255,0.02), transparent)",border:"1px solid rgba(255,255,255,0.04)"},children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--app-text)"},children:"No Events Yet"}),e.jsx("p",{className:"text-sm mb-4",style:{color:"var(--app-text)",opacity:.6},children:"Create your first event to start tracking"}),e.jsx("button",{onClick:()=>b(!0),className:"px-4 py-2 rounded-lg font-medium",style:{background:"var(--app-primary)",color:"#000"},children:"Create Event"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:k.map(s=>{const t=W(s),c=s.event_type||"submissions",g=f[c]||f.submissions;return e.jsxs("div",{className:"rounded-xl p-4",style:{background:"linear-gradient(180deg, rgba(255,255,255,0.02), transparent)",border:"1px solid rgba(255,255,255,0.04)"},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:g.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",style:{color:"var(--app-text)"},children:s.name}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium text-white ${t.color}`,children:t.label}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium text-white ${g.color}`,children:g.label})]})]})]}),e.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium",style:{background:"rgba(0, 194, 179, 0.1)",color:"var(--app-primary)"},children:s.discord_tag})]}),e.jsxs("div",{className:"text-sm mb-3",style:{color:"var(--app-text)",opacity:.7},children:[y(s.start_date)," - ",y(s.end_date)]}),s.description&&e.jsx("p",{className:"text-sm mb-3",style:{color:"var(--app-text)",opacity:.6},children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 mb-4 text-sm flex-wrap",style:{color:"var(--app-text)"},children:[(c==="submissions"||c==="both")&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",style:{color:"var(--app-primary)"},children:s.submission_count})," submissions"]}),(c==="discoveries"||c==="both")&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",style:{color:"#a855f7"},children:s.discovery_count})," discoveries"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",style:{color:"var(--app-accent-2)"},children:Math.max(s.participant_count||0,s.discovery_participant_count||0)})," participants"]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-3",style:{borderTop:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx("button",{onClick:()=>C(s),className:"flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors",style:{background:"rgba(0, 194, 179, 0.1)",color:"var(--app-primary)",border:"1px solid rgba(0, 194, 179, 0.2)"},children:"View Leaderboard"}),e.jsx("button",{onClick:()=>R(s),className:"px-3 py-2 rounded-lg text-sm transition-colors",style:{background:"rgba(255,255,255,0.05)",color:"var(--app-text)",border:"1px solid rgba(255,255,255,0.1)"},children:s.is_active?"Deactivate":"Activate"}),e.jsx("button",{onClick:()=>V(s),className:"px-3 py-2 rounded-lg text-sm transition-colors",style:{background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",border:"1px solid rgba(239, 68, 68, 0.2)"},children:"Delete"})]})]},s.id)})}),F&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>b(!1)}),e.jsxs("div",{className:"relative rounded-xl p-6 w-full max-w-md",style:{background:"var(--app-card)",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",style:{color:"var(--app-text)"},children:"Create New Event"}),e.jsxs("form",{onSubmit:I,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--app-text)"},children:"Event Name"}),e.jsx("input",{type:"text",value:l.name,onChange:s=>m({...l,name:s.target.value}),required:!0,className:"w-full px-3 py-2 rounded-lg",placeholder:"Winter Exploration Event"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--app-text)"},children:"Event Type"}),e.jsxs("select",{value:l.event_type,onChange:s=>m({...l,event_type:s.target.value}),className:"w-full px-3 py-2 rounded-lg",children:[e.jsx("option",{value:"submissions",children:"System Submissions"}),e.jsx("option",{value:"discoveries",children:"Discoveries"}),e.jsx("option",{value:"both",children:"Both (Systems + Discoveries)"})]})]}),a&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--app-text)"},children:"Community"}),e.jsxs("select",{value:l.discord_tag,onChange:s=>m({...l,discord_tag:s.target.value}),required:!0,className:"w-full px-3 py-2 rounded-lg",children:[e.jsx("option",{value:"",children:"Select community..."}),T.map(s=>e.jsx("option",{value:s.tag,children:s.name},s.tag))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--app-text)"},children:"Start Date"}),e.jsx("input",{type:"date",value:l.start_date,onChange:s=>m({...l,start_date:s.target.value}),required:!0,className:"w-full px-3 py-2 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--app-text)"},children:"End Date"}),e.jsx("input",{type:"date",value:l.end_date,onChange:s=>m({...l,end_date:s.target.value}),required:!0,className:"w-full px-3 py-2 rounded-lg"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--app-text)"},children:"Description (optional)"}),e.jsx("textarea",{value:l.description,onChange:s=>m({...l,description:s.target.value}),rows:3,className:"w-full px-3 py-2 rounded-lg",placeholder:"Describe the event..."})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"px-4 py-2 rounded-lg text-sm",style:{color:"var(--app-text)",border:"1px solid rgba(255,255,255,0.1)"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-lg text-sm font-medium",style:{background:"var(--app-primary)",color:"#000"},children:"Create Event"})]})]})]})]}),M&&n&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>N(!1)}),e.jsxs("div",{className:"relative rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",style:{background:"var(--app-card)",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold",style:{color:"var(--app-text)"},children:[(f[n.event_type]||f.submissions).icon," ",n.name]}),e.jsxs("p",{className:"text-sm mt-1",style:{color:"var(--app-text)",opacity:.6},children:[y(n.start_date)," - ",y(n.end_date)]})]}),e.jsx("button",{onClick:()=>N(!1),className:"p-2 rounded-lg transition-colors hover:bg-white/10",style:{color:"var(--app-text)"},children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),E(n).length>1&&e.jsx("div",{className:"flex items-center rounded-lg overflow-hidden mb-4",style:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)"},children:E(n).map(s=>e.jsx("button",{onClick:()=>P(s),className:"px-4 py-2 text-sm font-medium transition-colors flex-1",style:{background:d===s?"var(--app-primary)":"transparent",color:d===s?"#000":"var(--app-text)"},children:s==="submissions"?"Systems":s==="discoveries"?"Discoveries":"Combined"},s))}),e.jsxs("div",{className:`grid gap-4 mb-6 ${d==="combined"?"grid-cols-4":d==="submissions"?"grid-cols-3":"grid-cols-2"}`,children:[d==="submissions"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{background:"rgba(0, 194, 179, 0.1)"},children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--app-primary)"},children:o.totals.total_submissions||0}),e.jsx("div",{className:"text-sm",style:{color:"var(--app-text)",opacity:.7},children:"Submissions"})]}),e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{background:"rgba(34, 197, 94, 0.1)"},children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"#22c55e"},children:o.totals.total_approved||0}),e.jsx("div",{className:"text-sm",style:{color:"var(--app-text)",opacity:.7},children:"Approved"})]}),e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{background:"rgba(157, 78, 221, 0.1)"},children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--app-accent-2)"},children:o.totals.participants||0}),e.jsx("div",{className:"text-sm",style:{color:"var(--app-text)",opacity:.7},children:"Participants"})]})]}),d==="discoveries"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{background:"rgba(168, 85, 247, 0.1)"},children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"#a855f7"},children:o.totals.total_discoveries||0}),e.jsx("div",{className:"text-sm",style:{color:"var(--app-text)",opacity:.7},children:"Discoveries"})]}),e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{background:"rgba(157, 78, 221, 0.1)"},children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--app-accent-2)"},children:o.totals.participants||0}),e.jsx("div",{className:"text-sm",style:{color:"var(--app-text)",opacity:.7},children:"Discoverers"})]})]}),d==="combined"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{background:"rgba(0, 194, 179, 0.1)"},children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--app-primary)"},children:o.totals.total_submissions||0}),e.jsx("div",{className:"text-sm",style:{color:"var(--app-text)",opacity:.7},children:"Submissions"})]}),e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{background:"rgba(168, 85, 247, 0.1)"},children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"#a855f7"},children:o.totals.total_discoveries||0}),e.jsx("div",{className:"text-sm",style:{color:"var(--app-text)",opacity:.7},children:"Discoveries"})]}),e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{background:"rgba(245, 158, 11, 0.1)"},children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"#f59e0b"},children:o.totals.combined_total||0}),e.jsx("div",{className:"text-sm",style:{color:"var(--app-text)",opacity:.7},children:"Combined"})]}),e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{background:"rgba(157, 78, 221, 0.1)"},children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--app-accent-2)"},children:o.totals.participants||0}),e.jsx("div",{className:"text-sm",style:{color:"var(--app-text)",opacity:.7},children:"Participants"})]})]})]}),d==="discoveries"?e.jsx(G,{data:o.leaderboard,loading:w}):d==="combined"?e.jsx(J,{data:o.leaderboard,loading:w}):e.jsx(O,{data:o.leaderboard,showCommunity:!1,loading:w})]})]})]})}function G({data:i,loading:x}){return x?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"Loading leaderboard..."}):!i||i.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"No discoveries during this event period."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx("th",{className:"text-left py-3 px-2",style:{color:"var(--app-text)",opacity:.6},children:"Rank"}),e.jsx("th",{className:"text-left py-3 px-2",style:{color:"var(--app-text)",opacity:.6},children:"Discoverer"}),e.jsx("th",{className:"text-right py-3 px-2",style:{color:"var(--app-text)",opacity:.6},children:"Discoveries"}),e.jsx("th",{className:"text-right py-3 px-2",style:{color:"var(--app-text)",opacity:.6},children:"Types"})]})}),e.jsx("tbody",{children:i.map(a=>e.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.05)"},children:[e.jsx("td",{className:"py-3 px-2",children:e.jsx("span",{className:`font-bold ${a.rank<=3?"text-amber-400":""}`,style:{color:a.rank>3?"var(--app-text)":void 0},children:a.rank<=3?["","1st","2nd","3rd"][a.rank]:`#${a.rank}`})}),e.jsx("td",{className:"py-3 px-2 font-medium",style:{color:"var(--app-text)"},children:a.username}),e.jsx("td",{className:"py-3 px-2 text-right font-semibold",style:{color:"#a855f7"},children:a.total_discoveries}),e.jsxs("td",{className:"py-3 px-2 text-right",style:{color:"var(--app-text)",opacity:.7},children:[a.types_count," ",a.types_count===1?"type":"types"]})]},a.rank))})]})})}function J({data:i,loading:x}){return x?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"Loading leaderboard..."}):!i||i.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"No activity during this event period."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx("th",{className:"text-left py-3 px-2",style:{color:"var(--app-text)",opacity:.6},children:"Rank"}),e.jsx("th",{className:"text-left py-3 px-2",style:{color:"var(--app-text)",opacity:.6},children:"User"}),e.jsx("th",{className:"text-right py-3 px-2",style:{color:"var(--app-text)",opacity:.6},children:"Systems"}),e.jsx("th",{className:"text-right py-3 px-2",style:{color:"var(--app-text)",opacity:.6},children:"Discoveries"}),e.jsx("th",{className:"text-right py-3 px-2",style:{color:"var(--app-text)",opacity:.6},children:"Total"})]})}),e.jsx("tbody",{children:i.map(a=>e.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.05)"},children:[e.jsx("td",{className:"py-3 px-2",children:e.jsx("span",{className:`font-bold ${a.rank<=3?"text-amber-400":""}`,style:{color:a.rank>3?"var(--app-text)":void 0},children:a.rank<=3?["","1st","2nd","3rd"][a.rank]:`#${a.rank}`})}),e.jsx("td",{className:"py-3 px-2 font-medium",style:{color:"var(--app-text)"},children:a.username}),e.jsx("td",{className:"py-3 px-2 text-right",style:{color:"var(--app-primary)"},children:a.total_submissions}),e.jsx("td",{className:"py-3 px-2 text-right",style:{color:"#a855f7"},children:a.total_discoveries}),e.jsx("td",{className:"py-3 px-2 text-right font-semibold",style:{color:"#f59e0b"},children:a.combined_total})]},a.rank))})]})})}export{ae as default};
