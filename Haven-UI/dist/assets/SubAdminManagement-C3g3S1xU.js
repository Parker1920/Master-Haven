import{j as a}from"./vendor-three-B8lJlG1P.js";import{u as K,f as Q,b as r}from"./vendor-react-D7IcbEIw.js";import{a as p}from"./vendor-ui-B9ygI19o.js";import{C as E}from"./Card-C4YgI0Ez.js";import{B as n}from"./Button-CI6OWZ-Z.js";import{A as W,M as C}from"./index-CIVSKp76.js";const F=[{id:"system_create",label:"Create Systems",description:"Can create new star systems"},{id:"system_edit",label:"Edit Systems",description:"Can edit systems tagged with their Discord"},{id:"approvals",label:"Approvals",description:"Can approve/reject pending submissions"},{id:"batch_approvals",label:"Batch Approvals",description:"Can approve or reject multiple submissions at once"},{id:"stats",label:"View Statistics",description:"Can view database statistics"},{id:"settings",label:"Theme Settings",description:"Can customize theme colors"}];function te(){const j=K(),{partnerId:m}=Q(),c=r.useContext(W),[S,$]=r.useState([]),[M,A]=r.useState([]),[u,H]=r.useState([]),[R,k]=r.useState(!0),[x,o]=r.useState(!1),[T,h]=r.useState(!1),[L,_]=r.useState(!1),[O,g]=r.useState(!1),[i,b]=r.useState(null),[s,l]=r.useState({username:"",password:"",display_name:"",enabled_features:[],parent_partner_id:m||"",additional_discord_tags:[],can_approve_personal_uploads:!1}),[y,v]=r.useState("");r.useEffect(()=>{if(!c.isAdmin){alert("Admin access required"),j("/systems");return}f(),c.isSuperAdmin&&!m&&(B(),I())},[c.isAdmin,c.isSuperAdmin,j,m]);async function f(){k(!0);try{const e=m?`/api/sub_admins?partner_id=${m}`:"/api/sub_admins",t=await p.get(e);$(t.data.sub_admins||[])}catch(e){alert("Failed to load sub-admins: "+(e.response?.data?.detail||e.message))}finally{k(!1)}}async function B(){try{const e=await p.get("/api/partners");A(e.data.partners||[])}catch(e){console.error("Failed to load partners:",e)}}async function I(){try{const e=await p.get("/api/available_discord_tags");H(e.data.discord_tags||[])}catch(e){console.error("Failed to load discord tags:",e)}}function N(){l({username:"",password:"",display_name:"",enabled_features:[],parent_partner_id:m||(c.isSuperAdmin?"haven":""),additional_discord_tags:[],can_approve_personal_uploads:!1})}async function U(){if(!s.username.trim()||s.username.length<3){alert("Username must be at least 3 characters");return}if(!s.password||s.password.length<4){alert("Password must be at least 4 characters");return}o(!0);try{const e={username:s.username.trim(),password:s.password,display_name:s.display_name.trim()||s.username.trim(),enabled_features:s.enabled_features};s.parent_partner_id&&s.parent_partner_id!=="haven"?e.parent_partner_id=parseInt(s.parent_partner_id):s.parent_partner_id==="haven"&&(e.additional_discord_tags=s.additional_discord_tags,e.can_approve_personal_uploads=s.can_approve_personal_uploads),await p.post("/api/sub_admins",e),alert("Sub-admin account created successfully!"),h(!1),N(),f()}catch(e){alert("Failed to create sub-admin: "+(e.response?.data?.detail||e.message))}finally{o(!1)}}function V(e){b(e),l({username:e.username,password:"",display_name:e.display_name||"",enabled_features:e.enabled_features||[],parent_partner_id:e.parent_partner_id,additional_discord_tags:e.additional_discord_tags||[],can_approve_personal_uploads:e.can_approve_personal_uploads||!1}),_(!0)}async function q(){o(!0);try{const e={display_name:s.display_name.trim()||null,enabled_features:s.enabled_features,is_active:i.is_active};i.parent_partner_id||(e.additional_discord_tags=s.additional_discord_tags,e.can_approve_personal_uploads=s.can_approve_personal_uploads),await p.put(`/api/sub_admins/${i.id}`,e),alert("Sub-admin updated successfully!"),_(!1),b(null),N(),f()}catch(e){alert("Failed to update sub-admin: "+(e.response?.data?.detail||e.message))}finally{o(!1)}}function z(e){b(e),v(""),g(!0)}async function G(){if(!y||y.length<4){alert("New password must be at least 4 characters");return}o(!0);try{await p.post(`/api/sub_admins/${i.id}/reset_password`,{new_password:y}),alert("Password reset successfully!"),g(!1),b(null),v("")}catch(e){alert("Failed to reset password: "+(e.response?.data?.detail||e.message))}finally{o(!1)}}async function J(e){const t=e.is_active?"deactivate":"reactivate";if(confirm(`Are you sure you want to ${t} "${e.username}"?`)){o(!0);try{e.is_active?await p.delete(`/api/sub_admins/${e.id}`):await p.put(`/api/sub_admins/${e.id}`,{is_active:!0}),f()}catch(d){alert(`Failed to ${t} sub-admin: `+(d.response?.data?.detail||d.message))}finally{o(!1)}}}function P(e){l(t=>{const d=t.enabled_features||[];return d.includes(e)?{...t,enabled_features:d.filter(w=>w!==e)}:{...t,enabled_features:[...d,e]}})}function D(e){l(t=>{const d=t.additional_discord_tags||[];return d.includes(e)?{...t,additional_discord_tags:d.filter(w=>w!==e)}:{...t,additional_discord_tags:[...d,e]}})}return R?a.jsx("div",{className:"p-4",children:a.jsx(E,{children:a.jsx("p",{children:"Loading sub-admins..."})})}):a.jsxs("div",{className:"p-4",children:[a.jsxs(E,{className:"max-w-4xl",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold",children:"Sub-Admin Management"}),a.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Sub-admins can approve submissions (except their own) and manage content for their community."})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx(n,{className:"bg-green-600 text-white hover:bg-green-700",onClick:()=>{N(),h(!0)},children:"+ Create Sub-Admin"}),a.jsx(n,{className:"bg-gray-200 text-gray-800",onClick:()=>j(-1),children:"Back"})]})]}),S.length===0?a.jsx("div",{className:"text-gray-400 italic p-4 bg-gray-700 rounded",children:"No sub-admin accounts yet. Create one to allow community members to help with approvals."}):a.jsx("div",{className:"space-y-3",children:S.map(e=>a.jsx("div",{className:`border rounded p-4 ${e.is_active?"bg-cyan-700":"bg-gray-600 opacity-75"}`,children:a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h3",{className:"text-lg font-semibold",children:e.username}),!e.is_active&&a.jsx("span",{className:"px-2 py-0.5 rounded text-xs bg-red-500 text-white",children:"INACTIVE"})]}),e.display_name&&a.jsx("p",{className:"text-sm text-gray-300",children:e.display_name}),a.jsxs("p",{className:"text-sm text-cyan-300 mt-1",children:["Parent: ",e.parent_display_name||"Haven",e.parent_partner_id?` (${e.parent_discord_tag||"No tag"})`:" (Super Admin)"]}),a.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[(e.enabled_features||[]).map(t=>a.jsx("span",{className:"px-2 py-0.5 rounded text-xs bg-cyan-600 text-white",children:t},t)),(!e.enabled_features||e.enabled_features.length===0)&&a.jsx("span",{className:"text-sm text-gray-400 italic",children:"No features enabled"})]}),!e.parent_partner_id&&e.additional_discord_tags&&e.additional_discord_tags.length>0&&a.jsxs("div",{className:"mt-2",children:[a.jsx("span",{className:"text-xs text-gray-400",children:"Can also view: "}),a.jsx("span",{className:"text-xs text-yellow-400",children:e.additional_discord_tags.join(", ")})]}),!e.parent_partner_id&&e.can_approve_personal_uploads&&a.jsx("div",{className:"mt-1",children:a.jsx("span",{className:"px-2 py-0.5 rounded text-xs bg-purple-600 text-white",children:"Can approve personal uploads"})}),a.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["Created: ",new Date(e.created_at).toLocaleDateString(),e.last_login_at&&a.jsxs("span",{children:[" | Last login: ",new Date(e.last_login_at).toLocaleDateString()]})]})]}),a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx(n,{className:"bg-blue-600 text-white text-sm px-3 py-1",onClick:()=>V(e),children:"Edit"}),a.jsx(n,{className:"bg-yellow-600 text-white text-sm px-3 py-1",onClick:()=>z(e),children:"Reset Password"}),a.jsx(n,{className:`text-sm px-3 py-1 ${e.is_active?"bg-red-600 text-white":"bg-green-600 text-white"}`,onClick:()=>J(e),disabled:x,children:e.is_active?"Deactivate":"Reactivate"})]})]})},e.id))})]}),T&&a.jsx(C,{title:"Create Sub-Admin",onClose:()=>h(!1),children:a.jsxs("div",{className:"space-y-4",children:[c.isSuperAdmin&&!m&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Parent"}),a.jsxs("select",{className:"w-full border rounded p-2 bg-gray-700 text-white",value:s.parent_partner_id,onChange:e=>l({...s,parent_partner_id:e.target.value}),children:[a.jsx("option",{value:"haven",children:"Haven (Super Admin)"}),a.jsx("optgroup",{label:"Partners",children:M.filter(e=>e.is_active).map(e=>a.jsxs("option",{value:e.id,children:[e.display_name||e.username," (",e.discord_tag||"No tag",")"]},e.id))})]}),a.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Haven sub-admins report directly to you (no community tag)."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Username *"}),a.jsx("input",{type:"text",className:"w-full border rounded p-2 bg-gray-700 text-white",value:s.username,onChange:e=>l({...s,username:e.target.value}),placeholder:"min 3 characters"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Password *"}),a.jsx("input",{type:"password",className:"w-full border rounded p-2 bg-gray-700 text-white",value:s.password,onChange:e=>l({...s,password:e.target.value}),placeholder:"min 4 characters"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Display Name"}),a.jsx("input",{type:"text",className:"w-full border rounded p-2 bg-gray-700 text-white",value:s.display_name,onChange:e=>l({...s,display_name:e.target.value})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Enabled Features"}),a.jsx("div",{className:"space-y-2",children:F.map(e=>a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:s.enabled_features.includes(e.id),onChange:()=>P(e.id),className:"rounded"}),a.jsx("span",{className:"text-sm",children:e.label}),a.jsxs("span",{className:"text-xs text-gray-400",children:["- ",e.description]})]},e.id))})]}),s.parent_partner_id==="haven"&&c.isSuperAdmin&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Additional Discord Tag Visibility"}),a.jsx("p",{className:"text-xs text-gray-400 mb-2",children:"Select which partner discords this Haven sub-admin can see and approve submissions for."}),a.jsx("div",{className:"max-h-32 overflow-y-auto border border-gray-600 rounded p-2 bg-gray-800 space-y-2",children:u.length===0?a.jsx("p",{className:"text-sm text-gray-400 italic",children:"No partner discord tags available"}):u.filter(e=>e.discord_tag!=="Haven").map(e=>a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:s.additional_discord_tags.includes(e.discord_tag),onChange:()=>D(e.discord_tag),className:"rounded"}),a.jsx("span",{className:"text-sm",children:e.discord_tag})]},e.discord_tag))})]}),a.jsx("div",{className:"border-t border-gray-600 pt-3",children:a.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:s.can_approve_personal_uploads,onChange:e=>l({...s,can_approve_personal_uploads:e.target.checked}),className:"rounded w-5 h-5"}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-semibold",children:"Can Approve Personal Uploads"}),a.jsx("p",{className:"text-xs text-gray-400",children:"Allow this sub-admin to approve submissions without a discord tag."})]})]})})]}),a.jsxs("div",{className:"flex space-x-2 pt-3",children:[a.jsx(n,{className:"bg-green-600 text-white",onClick:U,disabled:x,children:x?"Creating...":"Create Sub-Admin"}),a.jsx(n,{className:"bg-gray-200 text-gray-800",onClick:()=>h(!1),children:"Cancel"})]})]})}),L&&i&&a.jsx(C,{title:`Edit: ${i.username}`,onClose:()=>_(!1),children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Display Name"}),a.jsx("input",{type:"text",className:"w-full border rounded p-2 bg-gray-700 text-white",value:s.display_name,onChange:e=>l({...s,display_name:e.target.value})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Enabled Features"}),a.jsx("div",{className:"space-y-2",children:F.map(e=>a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:s.enabled_features.includes(e.id),onChange:()=>P(e.id),className:"rounded"}),a.jsx("span",{className:"text-sm",children:e.label})]},e.id))})]}),!i.parent_partner_id&&c.isSuperAdmin&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold mb-1",children:"Additional Discord Tag Visibility"}),a.jsx("p",{className:"text-xs text-gray-400 mb-2",children:'Select which partner discords this Haven sub-admin can see and approve submissions for (in addition to "Haven").'}),a.jsx("div",{className:"max-h-48 overflow-y-auto border border-gray-600 rounded p-2 bg-gray-800 space-y-2",children:u.length===0?a.jsx("p",{className:"text-sm text-gray-400 italic",children:"No partner discord tags available"}):u.filter(e=>e.discord_tag!=="Haven").map(e=>a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:s.additional_discord_tags.includes(e.discord_tag),onChange:()=>D(e.discord_tag),className:"rounded"}),a.jsx("span",{className:"text-sm",children:e.discord_tag}),e.display_name&&a.jsxs("span",{className:"text-xs text-gray-400",children:["(",e.display_name,")"]})]},e.discord_tag))}),s.additional_discord_tags.length>0&&a.jsxs("p",{className:"text-xs text-cyan-400 mt-1",children:["Can view: Haven + ",s.additional_discord_tags.join(", ")]})]}),!i.parent_partner_id&&c.isSuperAdmin&&a.jsx("div",{className:"border-t border-gray-600 pt-4",children:a.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:s.can_approve_personal_uploads,onChange:e=>l({...s,can_approve_personal_uploads:e.target.checked}),className:"rounded w-5 h-5"}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-semibold",children:"Can Approve Personal Uploads"}),a.jsx("p",{className:"text-xs text-gray-400",children:"Allow this sub-admin to see and approve submissions without a discord tag (personal uploads). Note: Discord info will be hidden - only visible to super admin."})]})]})}),a.jsxs("div",{className:"flex space-x-2 pt-3",children:[a.jsx(n,{className:"bg-blue-600 text-white",onClick:q,disabled:x,children:x?"Saving...":"Save Changes"}),a.jsx(n,{className:"bg-gray-200 text-gray-800",onClick:()=>_(!1),children:"Cancel"})]})]})}),O&&i&&a.jsx(C,{title:`Reset Password: ${i.username}`,onClose:()=>g(!1),children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold mb-1",children:"New Password *"}),a.jsx("input",{type:"password",className:"w-full border rounded p-2 bg-gray-700 text-white",value:y,onChange:e=>v(e.target.value),placeholder:"min 4 characters"})]}),a.jsxs("div",{className:"flex space-x-2 pt-3",children:[a.jsx(n,{className:"bg-yellow-600 text-white",onClick:G,disabled:x,children:x?"Resetting...":"Reset Password"}),a.jsx(n,{className:"bg-gray-200 text-gray-800",onClick:()=>g(!1),children:"Cancel"})]})]})})]})}export{te as default};
