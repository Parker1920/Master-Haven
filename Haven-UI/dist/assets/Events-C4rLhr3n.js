import{j as e}from"./vendor-three-pXgRM845.js";import{u as $,b as s}from"./vendor-react-DGfbrl1l.js";import{a as l}from"./vendor-ui-B9ygI19o.js";import{L as q}from"./LeaderboardTable-DfBksKbX.js";import{A as I}from"./index-DgLtObAt.js";import{f as W,p as z}from"./parseISO-9NS-6p47.js";function Y(){const g=$(),c=s.useContext(I),{isSuperAdmin:v,isAdmin:n,isPartner:i,user:B}=c,[f,j]=s.useState(!0),[h,p]=s.useState([]),[N,w]=s.useState([]),[k,d]=s.useState(!1),[C,b]=s.useState(!1),[m,_]=s.useState(null),[x,E]=s.useState({leaderboard:[],totals:{}}),[S,y]=s.useState(!1),[r,o]=s.useState({name:"",discord_tag:"",start_date:"",end_date:"",description:""});s.useEffect(()=>{!c.loading&&!n&&!i&&g("/")},[c.loading,n,i,g]),s.useEffect(()=>{v&&(async()=>{try{const a=await l.get("/api/discord_tags");w(a.data.tags||[])}catch(a){console.error("Failed to fetch discord tags:",a)}})()},[v]),s.useEffect(()=>{if(!n&&!i)return;(async()=>{try{const a=await l.get("/api/events",{params:{include_inactive:!0},withCredentials:!0});p(a.data.events||[])}catch(a){console.error("Failed to fetch events:",a)}finally{j(!1)}})()},[n,i]);const L=async t=>{t.preventDefault();try{if((await l.post("/api/events",r,{withCredentials:!0})).data.success){const F=await l.get("/api/events",{params:{include_inactive:!0},withCredentials:!0});p(F.data.events||[]),d(!1),o({name:"",discord_tag:"",start_date:"",end_date:"",description:""})}}catch(a){console.error("Failed to create event:",a),alert(a.response?.data?.detail||"Failed to create event")}},D=async t=>{_(t),b(!0),y(!0);try{const a=await l.get(`/api/events/${t.id}/leaderboard`,{withCredentials:!0});E({leaderboard:a.data.leaderboard||[],totals:a.data.totals||{}})}catch(a){console.error("Failed to fetch event leaderboard:",a)}finally{y(!1)}},M=async t=>{try{await l.put(`/api/events/${t.id}`,{is_active:t.is_active?0:1},{withCredentials:!0});const a=await l.get("/api/events",{params:{include_inactive:!0},withCredentials:!0});p(a.data.events||[])}catch(a){console.error("Failed to toggle event:",a)}},T=async t=>{if(window.confirm(`Are you sure you want to delete "${t.name}"?`))try{await l.delete(`/api/events/${t.id}`,{withCredentials:!0});const a=await l.get("/api/events",{params:{include_inactive:!0},withCredentials:!0});p(a.data.events||[])}catch(a){console.error("Failed to delete event:",a)}},u=t=>{try{return W(z(t),"MMM d, yyyy")}catch{return t}},A=t=>{const a=new Date().toISOString();return t.is_active?t.start_date>a?{label:"Upcoming",color:"bg-blue-500"}:t.end_date+"T23:59:59"<a?{label:"Ended",color:"bg-gray-500"}:{label:"Active",color:"bg-green-500"}:{label:"Inactive",color:"bg-gray-500"}};return c.loading||f?e.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{background:"var(--app-bg)"},children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2",style:{borderColor:"var(--app-primary)"}})}):!n&&!i?null:e.jsxs("div",{className:"min-h-screen p-6",style:{background:"var(--app-bg)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",style:{color:"var(--app-text)"},children:"Submission Events"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--app-text)",opacity:.6},children:"Track submissions during event periods"})]}),e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors",style:{background:"var(--app-primary)",color:"#000"},children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"New Event"]})]}),h.length===0?e.jsxs("div",{className:"rounded-xl p-12 text-center",style:{background:"linear-gradient(180deg, rgba(255,255,255,0.02), transparent)",border:"1px solid rgba(255,255,255,0.04)"},children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸ“…"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--app-text)"},children:"No Events Yet"}),e.jsx("p",{className:"text-sm mb-4",style:{color:"var(--app-text)",opacity:.6},children:"Create your first submission event to start tracking"}),e.jsx("button",{onClick:()=>d(!0),className:"px-4 py-2 rounded-lg font-medium",style:{background:"var(--app-primary)",color:"#000"},children:"Create Event"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:h.map(t=>{const a=A(t);return e.jsxs("div",{className:"rounded-xl p-4",style:{background:"linear-gradient(180deg, rgba(255,255,255,0.02), transparent)",border:"1px solid rgba(255,255,255,0.04)"},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ†"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",style:{color:"var(--app-text)"},children:t.name}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium text-white ${a.color}`,children:a.label})]})]}),e.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium",style:{background:"rgba(0, 194, 179, 0.1)",color:"var(--app-primary)"},children:t.discord_tag})]}),e.jsxs("div",{className:"text-sm mb-3",style:{color:"var(--app-text)",opacity:.7},children:[u(t.start_date)," - ",u(t.end_date)]}),t.description&&e.jsx("p",{className:"text-sm mb-3",style:{color:"var(--app-text)",opacity:.6},children:t.description}),e.jsxs("div",{className:"flex items-center gap-4 mb-4 text-sm",style:{color:"var(--app-text)"},children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",style:{color:"var(--app-primary)"},children:t.submission_count})," submissions"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",style:{color:"var(--app-accent-2)"},children:t.participant_count})," participants"]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-3",style:{borderTop:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx("button",{onClick:()=>D(t),className:"flex-1 px-3 py-2 rounded-lg text-sm font-medium transition-colors",style:{background:"rgba(0, 194, 179, 0.1)",color:"var(--app-primary)",border:"1px solid rgba(0, 194, 179, 0.2)"},children:"View Leaderboard"}),e.jsx("button",{onClick:()=>M(t),className:"px-3 py-2 rounded-lg text-sm transition-colors",style:{background:"rgba(255,255,255,0.05)",color:"var(--app-text)",border:"1px solid rgba(255,255,255,0.1)"},children:t.is_active?"Deactivate":"Activate"}),e.jsx("button",{onClick:()=>T(t),className:"px-3 py-2 rounded-lg text-sm transition-colors",style:{background:"rgba(239, 68, 68, 0.1)",color:"#ef4444",border:"1px solid rgba(239, 68, 68, 0.2)"},children:"Delete"})]})]},t.id)})}),k&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>d(!1)}),e.jsxs("div",{className:"relative rounded-xl p-6 w-full max-w-md",style:{background:"var(--app-card)",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",style:{color:"var(--app-text)"},children:"Create New Event"}),e.jsxs("form",{onSubmit:L,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--app-text)"},children:"Event Name"}),e.jsx("input",{type:"text",value:r.name,onChange:t=>o({...r,name:t.target.value}),required:!0,className:"w-full px-3 py-2 rounded-lg",placeholder:"Winter Exploration Event"})]}),v&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--app-text)"},children:"Community"}),e.jsxs("select",{value:r.discord_tag,onChange:t=>o({...r,discord_tag:t.target.value}),required:!0,className:"w-full px-3 py-2 rounded-lg",children:[e.jsx("option",{value:"",children:"Select community..."}),N.map(t=>e.jsx("option",{value:t.tag,children:t.name},t.tag))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--app-text)"},children:"Start Date"}),e.jsx("input",{type:"date",value:r.start_date,onChange:t=>o({...r,start_date:t.target.value}),required:!0,className:"w-full px-3 py-2 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--app-text)"},children:"End Date"}),e.jsx("input",{type:"date",value:r.end_date,onChange:t=>o({...r,end_date:t.target.value}),required:!0,className:"w-full px-3 py-2 rounded-lg"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",style:{color:"var(--app-text)"},children:"Description (optional)"}),e.jsx("textarea",{value:r.description,onChange:t=>o({...r,description:t.target.value}),rows:3,className:"w-full px-3 py-2 rounded-lg",placeholder:"Describe the event..."})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>d(!1),className:"px-4 py-2 rounded-lg text-sm",style:{color:"var(--app-text)",border:"1px solid rgba(255,255,255,0.1)"},children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-lg text-sm font-medium",style:{background:"var(--app-primary)",color:"#000"},children:"Create Event"})]})]})]})]}),C&&m&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>b(!1)}),e.jsxs("div",{className:"relative rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",style:{background:"var(--app-card)",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold",style:{color:"var(--app-text)"},children:["ðŸ† ",m.name]}),e.jsxs("p",{className:"text-sm mt-1",style:{color:"var(--app-text)",opacity:.6},children:[u(m.start_date)," - ",u(m.end_date)]})]}),e.jsx("button",{onClick:()=>b(!1),className:"p-2 rounded-lg transition-colors hover:bg-white/10",style:{color:"var(--app-text)"},children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{background:"rgba(0, 194, 179, 0.1)"},children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--app-primary)"},children:x.totals.total_submissions||0}),e.jsx("div",{className:"text-sm",style:{color:"var(--app-text)",opacity:.7},children:"Total Submissions"})]}),e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{background:"rgba(34, 197, 94, 0.1)"},children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"#22c55e"},children:x.totals.total_approved||0}),e.jsx("div",{className:"text-sm",style:{color:"var(--app-text)",opacity:.7},children:"Approved"})]}),e.jsxs("div",{className:"p-4 rounded-lg text-center",style:{background:"rgba(157, 78, 221, 0.1)"},children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--app-accent-2)"},children:x.totals.participants||0}),e.jsx("div",{className:"text-sm",style:{color:"var(--app-text)",opacity:.7},children:"Participants"})]})]}),e.jsx(q,{data:x.leaderboard,showCommunity:!1,loading:S})]})]})]})}export{Y as default};
